<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIã‚¬ã‚¤ãƒ‰ãƒãƒ£ãƒƒãƒˆ - ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼å¯¾å¿œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #1a1a2e;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .mobile-frame {
            max-width: 375px;
            margin: 20px auto;
            border: 8px solid #2d3561;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8), 0 0 20px rgba(79, 172, 254, 0.2);
            background: #0f3460;
            height: 667px;
            display: flex;
            flex-direction: column;
        }

        .mobile-header {
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
            color: #4facfe;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(79, 172, 254, 0.3);
        }

        .mobile-header h2 {
            font-size: 1.1em;
            font-weight: 600;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
            color: #4ade80;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #chatContainer {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
        }

        .chat-message {
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .chat-avatar.ai {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .chat-avatar.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .chat-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .chat-bubble.ai {
            background: rgba(45, 53, 97, 0.8);
            border: 1px solid rgba(79, 172, 254, 0.3);
            color: #e0e0e0;
        }

        .chat-bubble.user {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .chat-bubble strong {
            color: #4facfe;
            display: block;
            margin-bottom: 8px;
        }

        .chat-bubble .guide-link {
            display: inline-block;
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
            padding: 6px 12px;
            border-radius: 8px;
            margin: 8px 4px 0 0;
            cursor: pointer;
            font-size: 0.9em;
            border: 1px solid rgba(79, 172, 254, 0.4);
            transition: all 0.3s;
        }

        .chat-bubble .guide-link:hover {
            background: rgba(79, 172, 254, 0.3);
            border-color: #4facfe;
        }

        .chat-bubble .action-button {
            display: inline-block;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #0f3460;
            padding: 8px 16px;
            border-radius: 12px;
            margin: 8px 4px 0 0;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            border: none;
            transition: all 0.3s;
        }

        .chat-bubble .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }

        .quick-reply-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .quick-reply {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            border: 1px solid rgba(79, 172, 254, 0.3);
            transition: all 0.3s;
        }

        .quick-reply:hover {
            background: rgba(79, 172, 254, 0.2);
            border-color: #4facfe;
            transform: translateY(-2px);
        }

        .loading-indicator {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: rgba(45, 53, 97, 0.6);
            border-radius: 18px;
            width: fit-content;
        }

        .loading-indicator.active {
            display: flex;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: #4facfe;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        #chatInputContainer {
            background: #0f3460;
            padding: 15px;
            border-top: 1px solid rgba(79, 172, 254, 0.3);
        }

        #chatInput {
            flex: 1;
            background: rgba(45, 53, 97, 0.6);
            color: #e0e0e0;
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 12px;
            padding: 12px;
            font-size: 0.95em;
            resize: none;
            min-height: 45px;
            max-height: 100px;
            font-family: inherit;
            width: 100%;
        }

        #chatInput:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .send-button {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #0f3460;
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            height: 45px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .input-hint {
            font-size: 0.8em;
            color: #888;
            margin-top: 8px;
        }

        /* ã‚¬ã‚¤ãƒ‰è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #16213e;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid rgba(79, 172, 254, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(79, 172, 254, 0.3);
        }

        .modal-title {
            font-size: 1.3em;
            color: #4facfe;
            font-weight: 600;
        }

        .modal-close {
            font-size: 1.5em;
            cursor: pointer;
            color: #888;
            transition: color 0.3s;
        }

        .modal-close:hover {
            color: #4facfe;
        }

        .guide-step {
            background: rgba(45, 53, 97, 0.6);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 3px solid #4facfe;
        }

        .guide-step-number {
            color: #4facfe;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .guide-warning {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            color: #fca5a5;
        }

        .guide-tip {
            background: rgba(34, 197, 94, 0.1);
            border-left: 3px solid #22c55e;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            color: #86efac;
        }
    </style>
</head>
<body>
    <div class="mobile-frame">
        <div class="mobile-header">
            <h2>ğŸ¤– AIã‚¬ã‚¤ãƒ‰</h2>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</span>
            </div>
        </div>

        <div id="chatContainer"></div>

        <div id="chatInputContainer">
            <div class="input-wrapper">
                <textarea 
                    id="chatInput" 
                    placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." 
                    rows="1"
                    onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                <button class="send-button" onclick="sendMessage()">
                    <span>é€ä¿¡</span>
                    <span>ğŸ“¤</span>
                </button>
            </div>
            <div class="input-hint">
                ğŸ’¡ Shift+Enterã§æ”¹è¡Œã§ãã¾ã™
            </div>
        </div>
    </div>

    <!-- ã‚¬ã‚¤ãƒ‰è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="guideModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <div class="modal-close" onclick="closeModal()">Ã—</div>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // APIãƒ™ãƒ¼ã‚¹URLï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // ãƒãƒ£ãƒƒãƒˆå±¥æ­´
        let chatHistory = [];
        
        // ç¾åœ¨ã®ãƒ•ãƒ­ãƒ¼çŠ¶æ…‹
        let currentFlow = {
            theme: 'THEME-001',
            currentNode: 'NODE-START',
            context: {}
        };

        // åˆæœŸåŒ–
        window.onload = function() {
            initializeChat();
        };

        function initializeChat() {
            showWelcomeMessage();
        }

        function showWelcomeMessage() {
            addMessage('ai', `ã“ã‚“ã«ã¡ã¯!å–æ‰±èª¬æ˜æ›¸AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ğŸš—

ãŠå›°ã‚Šã®ã“ã¨ãŒã‚ã‚Œã°ã€ãŠæ°—è»½ã«ã”è³ªå•ãã ã•ã„ã€‚

<div class="quick-reply-container">
    <div class="quick-reply" onclick="handleQuickReply('ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã§ãƒ‰ã‚¢ãŒé–‹ã‹ãªã„')">ğŸ”‘ ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã§ãƒ‰ã‚¢ãŒé–‹ã‹ãªã„</div>
    <div class="quick-reply" onclick="handleQuickReply('ã‚¨ã‚¢ã‚³ãƒ³ãŒå†·ãˆãªã„')">â„ï¸ ã‚¨ã‚¢ã‚³ãƒ³ãŒå†·ãˆãªã„</div>
    <div class="quick-reply" onclick="handleQuickReply('è­¦å‘Šç¯ãŒç‚¹ç¯ã—ãŸ')">âš ï¸ è­¦å‘Šç¯ãŒç‚¹ç¯ã—ãŸ</div>
</div>`);
        }

        function handleQuickReply(message) {
            sendMessage(message);
        }

        async function sendMessage(predefinedMessage) {
            const input = document.getElementById('chatInput');
            const message = predefinedMessage || input.value.trim();
            
            if (!message) return;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            addMessage('user', message);
            
            if (!predefinedMessage) {
                input.value = '';
            }
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            showLoading();
            
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†
            await processMessage(message);
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
            hideLoading();
        }

        async function processMessage(message) {
            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…å®¹ã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†å²
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼') || lowerMessage.includes('ãƒ‰ã‚¢') || lowerMessage.includes('é–‹ã‹ãªã„')) {
                await handleSmartKeyIssue();
            } else if (lowerMessage.includes('ã‚¨ã‚¢ã‚³ãƒ³')) {
                handleAirConditionerIssue();
            } else {
                handleGenericQuery(message);
            }
        }

        async function handleSmartKeyIssue() {
            addMessage('ai', `<strong>ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã§ãƒ‰ã‚¢ãŒé–‹ã‹ãªã„çŠ¶æ³ã§ã™ã­</strong>

ã¾ãšã€ã„ãã¤ã‹ç¢ºèªã•ã›ã¦ãã ã•ã„ã€‚

ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãƒ©ãƒ³ãƒ—ã¯ç‚¹ç¯ã—ã¾ã™ã‹?

<div class="quick-reply-container">
    <div class="quick-reply" onclick="handleIndicatorResponse('yes')">âœ… ã¯ã„ã€ç‚¹ç¯ã—ã¾ã™</div>
    <div class="quick-reply" onclick="handleIndicatorResponse('no')">âŒ ã„ã„ãˆã€ç‚¹ç¯ã—ã¾ã›ã‚“</div>
    <div class="quick-reply" onclick="handleIndicatorResponse('unknown')">â“ ã‚ã‹ã‚Šã¾ã›ã‚“</div>
</div>`);
        }

        function handleIndicatorResponse(response) {
            if (response === 'yes') {
                addMessage('user', 'ã¯ã„ã€ç‚¹ç¯ã—ã¾ã™');
                setTimeout(() => {
                    showLoading();
                    setTimeout(() => {
                        hideLoading();
                        handleElectricInterference();
                    }, 1000);
                }, 300);
            } else if (response === 'no') {
                addMessage('user', 'ã„ã„ãˆã€ç‚¹ç¯ã—ã¾ã›ã‚“');
                setTimeout(() => {
                    showLoading();
                    setTimeout(() => {
                        hideLoading();
                        handleBatteryIssue();
                    }, 1000);
                }, 300);
            } else {
                addMessage('user', 'ã‚ã‹ã‚Šã¾ã›ã‚“');
                setTimeout(() => {
                    showLoading();
                    setTimeout(() => {
                        hideLoading();
                        showIndicatorCheckGuide();
                    }, 1000);
                }, 300);
            }
        }

        function handleBatteryIssue() {
            addMessage('ai', `<strong>é›»æ± åˆ‡ã‚Œã®å¯èƒ½æ€§ãŒé«˜ã„ã§ã™</strong>

ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®é›»æ± ãŒåˆ‡ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

<strong>ã™ãã«ã§ãã‚‹å¯¾å¿œ:</strong>
<div class="guide-link" onclick="showGuide('GUIDE-001')">ğŸ“– æ©Ÿæ¢°ã‚­ãƒ¼ã®å–ã‚Šå‡ºã—æ–¹</div>

æ©Ÿæ¢°ã‚­ãƒ¼ã‚’ä½¿ãˆã°ã€ä»Šã™ããƒ‰ã‚¢ã‚’é–‹ã‘ã‚‰ã‚Œã¾ã™ã€‚

<strong>é›»æ± äº¤æ›ã«ã¤ã„ã¦:</strong>
<div class="action-button" onclick="handleBatteryReplacement()">ğŸ”‹ é›»æ± äº¤æ›ã®æ–¹æ³•ã‚’è¦‹ã‚‹</div>
<div class="action-button" onclick="findNearbyStores()">ğŸª è¿‘ãã®åº—èˆ—ã‚’æ¢ã™</div>
<div class="action-button" onclick="findDealers()">ğŸš— è²©å£²åº—ã‚’æ¢ã™</div>`);
        }

        function handleElectricInterference() {
            addMessage('ai', `<strong>é›»æ³¢å¹²æ¸‰ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</strong>

ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãŒç‚¹ç¯ã™ã‚‹ã®ã«è»Šä¸¡ãŒåå¿œã—ãªã„å ´åˆã€ä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„:

<strong>1. ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã‚’è»Šä½“ã«è¿‘ã¥ã‘ã‚‹</strong>
ãƒ‰ã‚¢ãƒãƒ³ãƒ‰ãƒ«ã«ç›´æ¥è¿‘ã¥ã‘ã¦æ“ä½œã—ã¦ã¿ã¦ãã ã•ã„ã€‚

<strong>2. é›»æ³¢å¹²æ¸‰æºã‹ã‚‰é›¢ã‚Œã‚‹</strong>
ç©ºæ¸¯ã€æ”¾é€å±€ã€æºå¸¯åŸºåœ°å±€ã®è¿‘ãã§ã¯é›»æ³¢å¹²æ¸‰ãŒèµ·ã“ã‚Šã‚„ã™ã„ã§ã™ã€‚

ãã‚Œã§ã‚‚æ”¹å–„ã—ãªã„å ´åˆ:
<div class="guide-link" onclick="showGuide('GUIDE-008')">ğŸ“– é›»æ³¢å¹²æ¸‰æ™‚ã®è©³ã—ã„å¯¾å¿œæ–¹æ³•</div>
<div class="action-button" onclick="findDealers()">ğŸš— è²©å£²åº—ã§ç‚¹æ¤œã—ã¦ã‚‚ã‚‰ã†</div>`);
        }

        function handleBatteryReplacement() {
            addMessage('ai', `<strong>é›»æ± äº¤æ›ã®é¸æŠè‚¢</strong>

é›»æ± äº¤æ›ã¯ä»¥ä¸‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™:

<strong>1. è‡ªåˆ†ã§äº¤æ›ã™ã‚‹ï¼ˆæ¨å¥¨é›£æ˜“åº¦: â˜…â˜…â˜†â˜†â˜†ï¼‰</strong>
â€¢ æ‰€è¦æ™‚é–“: ç´„5åˆ†
â€¢ å¿…è¦ãªã‚‚ã®: ãƒã‚¤ãƒŠã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼2æœ¬ã€CR2450é›»æ± 

<div class="guide-link" onclick="showGuide('GUIDE-003')">ğŸ“‹ æº–å‚™ç‰©ãƒªã‚¹ãƒˆ</div>
<div class="guide-link" onclick="showGuide('GUIDE-005')">ğŸ“– äº¤æ›æ‰‹é †ï¼ˆè©³ç´°ï¼‰</div>
<div class="action-button" onclick="findNearbyStores()">ğŸª é›»æ± ã‚’è²·ãˆã‚‹åº—ã‚’æ¢ã™</div>

<strong>2. è²©å£²åº—ã§äº¤æ›ã—ã¦ã‚‚ã‚‰ã†ï¼ˆæ¨å¥¨ï¼‰</strong>
â€¢ æ‰€è¦æ™‚é–“: ç´„10-15åˆ†
â€¢ è²»ç”¨: åº—èˆ—ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„

<div class="action-button" onclick="findDealers()">ğŸš— è¿‘ãã®è²©å£²åº—ã‚’æ¢ã™</div>

<div class="guide-warning">
âš ï¸ æ³¨æ„: è‡ªåˆ†ã§äº¤æ›ã™ã‚‹å ´åˆã€éƒ¨å“ãŒç ´æã™ã‚‹ãŠãã‚ŒãŒã‚ã‚Šã¾ã™
</div>

ã©ã¡ã‚‰ã®æ–¹æ³•ã‚’ãŠé¸ã³ã«ãªã‚Šã¾ã™ã‹?`);
        }

        async function findNearbyStores() {
            addMessage('user', 'è¿‘ãã®åº—èˆ—ã‚’æ¢ã™');
            showLoading();
            
            // ä½ç½®æƒ…å ±ã‚’å–å¾—
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude } = position.coords;
                        
                        try {
                            const response = await fetch(`${API_BASE_URL}/nearby-stores`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    location: { latitude, longitude },
                                    item: 'CR2450',
                                    radius_km: 5
                                })
                            });
                            
                            const data = await response.json();
                            hideLoading();
                            displayNearbyStores(data.stores);
                        } catch (error) {
                            console.error('API Error:', error);
                            hideLoading();
                            // ãƒ‡ãƒ¢ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                            displayNearbyStoresDemo();
                        }
                    },
                    (error) => {
                        console.error('Location Error:', error);
                        hideLoading();
                        // ãƒ‡ãƒ¢ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                        displayNearbyStoresDemo();
                    }
                );
            } else {
                hideLoading();
                displayNearbyStoresDemo();
            }
        }

        function displayNearbyStoresDemo() {
            addMessage('ai', `<strong>è¿‘éš£ã®åº—èˆ—ï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼‰</strong>

CR2450é›»æ± ã‚’è³¼å…¥ã§ãã‚‹è¿‘ãã®åº—èˆ—ã§ã™:

<strong>1. ãƒ¨ãƒ‰ãƒã‚·ã‚«ãƒ¡ãƒ© æ–°å®¿è¥¿å£æœ¬åº—</strong>
ğŸ“ è·é›¢: 1.2km
ğŸª åœ¨åº«: é«˜ç¢ºç‡ã§ã‚ã‚Š
ğŸ“ 03-3346-1010
â° 9:30-22:00

<strong>2. ãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ© æ¸‹è°·æ±å£åº—</strong>
ğŸ“ è·é›¢: 2.5km
ğŸª åœ¨åº«: é«˜ç¢ºç‡ã§ã‚ã‚Š
ğŸ“ 03-5466-1111
â° 10:00-21:00

<strong>3. ã‚»ã‚¤ã‚³ãƒ¼ã‚¦ã‚©ãƒƒãƒã‚µãƒ­ãƒ³ éŠ€åº§</strong>
ğŸ“ è·é›¢: 3.1km
ğŸª åœ¨åº«: é«˜ç¢ºç‡ã§ã‚ã‚Š
ğŸ“ 03-3563-1111
â° 11:00-19:30

<div class="guide-tip">
ğŸ’¡ ãƒ’ãƒ³ãƒˆ: æ¥åº—å‰ã«é›»è©±ã§åœ¨åº«ç¢ºèªã‚’ãŠã™ã™ã‚ã—ã¾ã™
</div>

<div class="action-button" onclick="showGuide('GUIDE-004')">ğŸ›’ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§è³¼å…¥ã™ã‚‹</div>`);
        }

        async function findDealers() {
            addMessage('user', 'è²©å£²åº—ã‚’æ¢ã™');
            showLoading();
            
            // ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
            setTimeout(() => {
                hideLoading();
                displayDealersDemo();
            }, 1000);
        }

        function displayDealersDemo() {
            addMessage('ai', `<strong>è¿‘ãã®ãƒˆãƒ¨ã‚¿è²©å£²åº—ï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼‰</strong>

é›»æ± äº¤æ›ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹è²©å£²åº—ã§ã™:

<strong>1. ãƒˆãƒ¨ã‚¿æ±äº¬ã‚«ãƒ­ãƒ¼ãƒ© æ–°å®¿åº—</strong>
ğŸ“ è·é›¢: 2.3km
â° ã‚µãƒ¼ãƒ“ã‚¹: å¹³æ—¥ 9:00-18:00 / åœŸ 9:00-17:00
ğŸ“ 03-3363-5111
âœ… ã‚µãƒ¼ãƒ“ã‚¹: é›»æ± äº¤æ›ã€ã‚­ãƒ¼ä¿®ç†ã€ç‚¹æ¤œ

<div class="action-button" onclick="reserveDealer('DEALER-001')">ğŸ“… äºˆç´„ã™ã‚‹</div>

<strong>2. ãƒˆãƒ¨ã‚¿ã‚«ãƒ­ãƒ¼ãƒ©æ±äº¬ æ¸‹è°·åº—</strong>
ğŸ“ è·é›¢: 3.5km
â° ã‚µãƒ¼ãƒ“ã‚¹: æ¯æ—¥ 9:00-18:00
ğŸ“ 03-3463-5111
âœ… ã‚µãƒ¼ãƒ“ã‚¹: é›»æ± äº¤æ›ã€ã‚­ãƒ¼ä¿®ç†ã€ç‚¹æ¤œ

<div class="action-button" onclick="reserveDealer('DEALER-002')">ğŸ“… äºˆç´„ã™ã‚‹</div>

<div class="guide-tip">
ğŸ’¡ äºˆç´„ãªã—ã§ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ãŒã€å¾…ã¡æ™‚é–“çŸ­ç¸®ã®ãŸã‚äºˆç´„ã‚’ãŠã™ã™ã‚ã—ã¾ã™
</div>`);
        }

        function reserveDealer(dealerId) {
            addMessage('ai', `<strong>äºˆç´„æ©Ÿèƒ½ï¼ˆãƒ‡ãƒ¢ï¼‰</strong>

å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ã“ã“ã§äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:

â€¢ å¸Œæœ›æ—¥æ™‚ã®é¸æŠ
â€¢ ãŠå®¢æ§˜æƒ…å ±ã®å…¥åŠ›
â€¢ è»Šä¸¡æƒ…å ±ã®å…¥åŠ›
â€¢ äºˆç´„ç¢ºèª

<div class="guide-warning">
âš ï¸ æœ¬æ©Ÿèƒ½ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™
</div>

<div class="action-button" onclick="alert('äºˆç´„APIã«æ¥ç¶šã—ã¾ã™: ${API_BASE_URL}/dealers/reserve')">ğŸ“ é›»è©±ã§äºˆç´„ã™ã‚‹</div>`);
        }

        function displayNearbyStores(stores) {
            if (!stores || stores.length === 0) {
                displayNearbyStoresDemo();
                return;
            }
            
            let storesHtml = '<strong>è¿‘éš£ã®åº—èˆ—</strong><br><br>';
            stores.slice(0, 3).forEach((store, index) => {
                storesHtml += `<strong>${index + 1}. ${store.name}</strong><br>`;
                storesHtml += `ğŸ“ è·é›¢: ${store.distance_km}km<br>`;
                storesHtml += `ğŸª åœ¨åº«: ${store.battery_availability?.availability || 'è¦ç¢ºèª'}<br>`;
                if (store.contact?.phone) {
                    storesHtml += `ğŸ“ ${store.contact.phone}<br>`;
                }
                storesHtml += `<br>`;
            });
            
            addMessage('ai', storesHtml);
        }

        function showIndicatorCheckGuide() {
            addMessage('ai', `<strong>ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãƒ©ãƒ³ãƒ—ã®ç¢ºèªæ–¹æ³•</strong>

ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã€å°ã•ãªèµ¤ã„ãƒ©ãƒ³ãƒ—ãŒå…‰ã‚‹ã‹ã©ã†ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<strong>ç¢ºèªæ–¹æ³•:</strong>
1. ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒ­ãƒƒã‚¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™
2. ã‚­ãƒ¼æœ¬ä½“ã‚’è¦‹ã¦ã€ãƒ©ãƒ³ãƒ—ãŒå…‰ã‚‹ã‹ç¢ºèª

<div class="quick-reply-container">
    <div class="quick-reply" onclick="handleIndicatorResponse('yes')">âœ… å…‰ã‚Šã¾ã—ãŸ</div>
    <div class="quick-reply" onclick="handleIndicatorResponse('no')">âŒ å…‰ã‚Šã¾ã›ã‚“</div>
</div>`);
        }

        function handleAirConditionerIssue() {
            addMessage('ai', `<strong>ã‚¨ã‚¢ã‚³ãƒ³ãŒå†·ãˆãªã„å ´åˆã®è¨ºæ–­</strong>

ä»¥ä¸‹ã®é †ç•ªã§ç¢ºèªã—ã¦ãã ã•ã„:

<strong>1. æ¸©åº¦è¨­å®šã‚’ç¢ºèª</strong>
â€¢ è¨­å®šæ¸©åº¦ãŒä½ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
â€¢ æ¨å¥¨: 18-22â„ƒ

<strong>2. é¢¨é‡ã‚’ç¢ºèª</strong>
â€¢ é¢¨é‡ãŒã€Œå¼±ã€ã«ãªã£ã¦ã„ãªã„ã‹ç¢ºèª
â€¢ å†·æˆ¿æ™‚ã¯ã€Œä¸­ã€ä»¥ä¸Šã‚’æ¨å¥¨

<strong>3. ã‚¨ã‚¢ã‚³ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ç¢ºèª</strong>
â€¢ æœ€å¾Œã®äº¤æ›ã‹ã‚‰1å¹´ä»¥ä¸ŠçµŒéã—ã¦ã„ã‚‹å ´åˆã¯äº¤æ›ã‚’æ¨å¥¨

<div class="action-button" onclick="findDealers()">ğŸš— è²©å£²åº—ã§ç‚¹æ¤œã—ã¦ã‚‚ã‚‰ã†</div>`);
        }

        function handleGenericQuery(message) {
            addMessage('ai', `ã”è³ªå•ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚

ã€Œ${message}ã€ã«ã¤ã„ã¦ã€ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹?

ã¾ãŸã¯ã€ä»¥ä¸‹ã®é …ç›®ã‹ã‚‰ãŠé¸ã³ãã ã•ã„:

<div class="quick-reply-container">
    <div class="quick-reply" onclick="handleQuickReply('ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã§ãƒ‰ã‚¢ãŒé–‹ã‹ãªã„')">ğŸ”‘ ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼</div>
    <div class="quick-reply" onclick="handleQuickReply('ã‚¨ã‚¢ã‚³ãƒ³ãŒå†·ãˆãªã„')">â„ï¸ ã‚¨ã‚¢ã‚³ãƒ³</div>
    <div class="quick-reply" onclick="handleQuickReply('è­¦å‘Šç¯ãŒç‚¹ç¯ã—ãŸ')">âš ï¸ è­¦å‘Šç¯</div>
</div>`);
        }

        function showGuide(guideId) {
            const guides = {
                'GUIDE-001': {
                    title: 'æ©Ÿæ¢°ã‚­ãƒ¼ã®å–ã‚Šå‡ºã—æ–¹',
                    content: `
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 1</div>
                            ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒ­ãƒƒã‚¯è§£é™¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™<br>
                            <small>ğŸ’¡ ãƒœã‚¿ãƒ³ã¯å´é¢ã«ã‚ã‚Šã¾ã™</small>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 2</div>
                            æ©Ÿæ¢°ã‚­ãƒ¼ã‚’å¼•ãæŠœã
                        </div>
                        <div class="guide-warning">
                            âš ï¸ æ©Ÿæ¢°ã‚­ãƒ¼ã¯ç„¡ç†ã«å¼•ãæŠœã‹ãªã„ã§ãã ã•ã„<br>
                            âš ï¸ ä½¿ç”¨å¾Œã¯å¿…ãšå…ƒã®ä½ç½®ã«æˆ»ã—ã¦ãã ã•ã„
                        </div>
                        <div class="guide-tip">
                            âœ… æ‰€è¦æ™‚é–“: ç´„1åˆ†<br>
                            âœ… é›£æ˜“åº¦: ã‹ã‚“ãŸã‚“
                        </div>
                    `
                },
                'GUIDE-003': {
                    title: 'é›»æ± äº¤æ›ã®æº–å‚™ç‰©',
                    content: `
                        <strong>å¿…è¦ãªã‚‚ã®:</strong>
                        <div class="guide-step">
                            <div class="guide-step-number">1. ãƒã‚¤ãƒŠã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼</div>
                            ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®ã‚«ãƒãƒ¼ã‚’é–‹ã‘ã‚‹ãŸã‚ã«ä½¿ç”¨<br>
                            ã‚µã‚¤ã‚º: ä¸­ã‚µã‚¤ã‚ºï¼ˆå…ˆç«¯å¹… 5-6mmç¨‹åº¦ï¼‰
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">2. å°ã•ã„ãƒã‚¤ãƒŠã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼</div>
                            é›»æ± ã‚’å–ã‚Šå‡ºã™ãŸã‚ã«ä½¿ç”¨<br>
                            ã‚µã‚¤ã‚º: å°ã‚µã‚¤ã‚ºï¼ˆå…ˆç«¯å¹… 2-3mmç¨‹åº¦ï¼‰
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">3. ãƒªãƒã‚¦ãƒ é›»æ±  CR2450</div>
                            äº¤æ›ç”¨ã®æ–°ã—ã„é›»æ± <br>
                            3V ãƒªãƒã‚¦ãƒ ã‚³ã‚¤ãƒ³é›»æ± 
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">4. å¸ƒã¾ãŸã¯æŸ”ã‚‰ã‹ã„ã‚¯ãƒ­ã‚¹ï¼ˆæ¨å¥¨ï¼‰</div>
                            ã‚«ãƒãƒ¼ã«å‚·ã‚’ã¤ã‘ãªã„ãŸã‚ã®ä¿è­·ç”¨
                        </div>
                        <div class="guide-tip">
                            ğŸ’¡ é›»æ± ã®å‹ç•ªã‚’å¿…ãšç¢ºèªã—ã¦ãã ã•ã„ï¼ˆCR2450ï¼‰<br>
                            ğŸ’¡ ã™ã¹ã¦æƒã£ã¦ã‹ã‚‰ä½œæ¥­ã‚’é–‹å§‹ã—ã¦ãã ã•ã„
                        </div>
                    `
                },
                'GUIDE-004': {
                    title: 'é›»æ± è³¼å…¥æ–¹æ³•',
                    content: `
                        <strong>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è³¼å…¥:</strong>
                        <div class="guide-step">
                            <div class="guide-step-number">Amazon</div>
                            ä¾¡æ ¼: Â¥200-500<br>
                            é…é€: æœ€çŸ­ç¿Œæ—¥<br>
                            <small>Primeä¼šå“¡ã¯é€æ–™ç„¡æ–™</small>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">æ¥½å¤©å¸‚å ´</div>
                            ä¾¡æ ¼: Â¥200-500<br>
                            é…é€: 2-3æ—¥<br>
                            <small>ãƒã‚¤ãƒ³ãƒˆåˆ©ç”¨å¯èƒ½</small>
                        </div>
                        <strong>å®Ÿåº—èˆ—:</strong>
                        â€¢ ãƒˆãƒ¨ã‚¿è²©å£²åº—ï¼ˆç´”æ­£å“ï¼‰<br>
                        â€¢ æ™‚è¨ˆåº—ï¼ˆç¨®é¡è±Šå¯Œï¼‰<br>
                        â€¢ ã‚«ãƒ¡ãƒ©åº—<br>
                        â€¢ å®¶é›»é‡è²©åº—<br>
                        â€¢ ã‚³ãƒ³ãƒ“ãƒ‹ï¼ˆåº—èˆ—ã«ã‚ˆã‚Šåœ¨åº«ç•°ãªã‚‹ï¼‰
                        <div class="guide-tip">
                            ğŸ’¡ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³è³¼å…¥ã®å ´åˆã€åˆ°ç€ã¾ã§æ©Ÿæ¢°ã‚­ãƒ¼ã‚’ã”ä½¿ç”¨ãã ã•ã„<br>
                            ğŸ’¡ åº—èˆ—è³¼å…¥ã®å ´åˆã€åœ¨åº«ç¢ºèªã®ãŸã‚äº‹å‰ã«é›»è©±é€£çµ¡ã‚’ãŠã™ã™ã‚ã—ã¾ã™
                        </div>
                    `
                },
                'GUIDE-005': {
                    title: 'é›»æ± äº¤æ›æ‰‹é †',
                    content: `
                        <div class="guide-warning">
                            âš ï¸ é›»æ± ã¯ã”è‡ªèº«ã§äº¤æ›ã§ãã¾ã™ãŒã€éƒ¨å“ãŒç ´æã™ã‚‹ãŠãã‚ŒãŒã‚ã‚‹ã®ã§ã€ãƒˆãƒ¨ã‚¿è²©å£²åº—ã§äº¤æ›ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 1</div>
                            æ©Ÿæ¢°ã‚­ãƒ¼ã‚’å–ã‚Šå‡ºã™
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 2</div>
                            ãƒã‚¤ãƒŠã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§ã‚«ãƒãƒ¼ã‚’é–‹ã‘ã‚‹<br>
                            <small>âš ï¸ ã‚«ãƒãƒ¼ã«å‚·ã‚’ã¤ã‘ãªã„ã‚ˆã†ã€å¸ƒãªã©ã‚’å½“ã¦ã¦ãã ã•ã„</small>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 3</div>
                            å°ã•ã„ãƒã‚¤ãƒŠã‚¹ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã§å¤ã„é›»æ± ã‚’å–ã‚Šå‡ºã™<br>
                            <small>âš ï¸ é›»æ± ã®å‘ãã‚’ç¢ºèªã—ã¦ãã ã•ã„</small>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 4</div>
                            æ–°ã—ã„CR2450é›»æ± ã‚’+(ãƒ—ãƒ©ã‚¹)é¢ã‚’ä¸Šã«ã—ã¦å–ã‚Šä»˜ã‘ã‚‹<br>
                            <small>âš ï¸ é›»æ± ã®å‘ãã‚’é–“é•ãˆãªã„ã§ãã ã•ã„</small>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 5</div>
                            ã‚«ãƒãƒ¼ã‚’é–‰ã˜ã‚‹<br>
                            <small>ğŸ’¡ ã‚«ãƒãƒƒã¨éŸ³ãŒã™ã‚‹ã¾ã§ç¢ºå®Ÿã«é–‰ã˜ã¦ãã ã•ã„</small>
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 6</div>
                            æ©Ÿæ¢°ã‚­ãƒ¼ã‚’å…ƒã«æˆ»ã™
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">ã‚¹ãƒ†ãƒƒãƒ— 7</div>
                            å‹•ä½œç¢ºèª<br>
                            ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€è»Šä¸¡ãŒåå¿œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
                        </div>
                        <div class="guide-tip">
                            âœ… æ‰€è¦æ™‚é–“: ç´„5åˆ†<br>
                            âœ… é›£æ˜“åº¦: ãµã¤ã†
                        </div>
                    `
                },
                'GUIDE-008': {
                    title: 'é›»æ³¢å¹²æ¸‰æ™‚ã®å¯¾å¿œ',
                    content: `
                        <strong>é›»æ³¢å¹²æ¸‰ãŒèµ·ã“ã‚Šã‚„ã™ã„å ´æ‰€:</strong>
                        â€¢ ç©ºæ¸¯ï¼ˆèˆªç©ºç®¡åˆ¶ãƒ¬ãƒ¼ãƒ€ãƒ¼ï¼‰<br>
                        â€¢ æ”¾é€å±€ï¼ˆé€ä¿¡ã‚¢ãƒ³ãƒ†ãƒŠï¼‰<br>
                        â€¢ ç™ºé›»æ‰€ãƒ»å¤‰é›»æ‰€ï¼ˆå¼·åŠ›ãªé›»ç£æ³¢ï¼‰<br>
                        â€¢ ãƒ†ãƒ¬ãƒ“å¡”<br>
                        â€¢ æºå¸¯é›»è©±ã®åŸºåœ°å±€ä»˜è¿‘<br>
                        
                        <strong>å¯¾å‡¦æ³•:</strong>
                        <div class="guide-step">
                            <div class="guide-step-number">æ–¹æ³• 1: ã‚­ãƒ¼ã‚’è»Šä½“ã«è¿‘ã¥ã‘ã‚‹</div>
                            ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã‚’è»Šä¸¡ã®ãƒ‰ã‚¢ãƒãƒ³ãƒ‰ãƒ«ã«ç›´æ¥è¿‘ã¥ã‘ã¦æ“ä½œ
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">æ–¹æ³• 2: æ©Ÿæ¢°ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹</div>
                            é›»æ³¢å¹²æ¸‰ãŒå¼·ã„å ´åˆã¯ã€æ©Ÿæ¢°ã‚­ãƒ¼ã§ãƒ‰ã‚¢ã‚’é–‹é–‰
                        </div>
                        <div class="guide-step">
                            <div class="guide-step-number">æ–¹æ³• 3: å ´æ‰€ã‚’ç§»å‹•ã™ã‚‹</div>
                            å¯èƒ½ã§ã‚ã‚Œã°ã€é›»æ³¢ã®å½±éŸ¿ãŒå°‘ãªã„å ´æ‰€ã«è»Šã‚’ç§»å‹•
                        </div>
                        <div class="guide-tip">
                            ğŸ’¡ ã“ã®ç¾è±¡ã¯ä¸€æ™‚çš„ãªã‚‚ã®ã§ã€ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ã‚„è»Šä¸¡ã®æ•…éšœã§ã¯ã‚ã‚Šã¾ã›ã‚“
                        </div>
                    `
                }
            };
            
            const guide = guides[guideId];
            if (guide) {
                document.getElementById('modalTitle').innerHTML = guide.title;
                document.getElementById('modalBody').innerHTML = guide.content;
                document.getElementById('guideModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('guideModal').classList.remove('active');
        }

        function addMessage(sender, content) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = `chat-avatar ${sender}`;
            avatar.textContent = sender === 'ai' ? 'ğŸ¤–' : 'ğŸ‘¤';
            
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender}`;
            bubble.innerHTML = content;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(bubble);
            container.appendChild(messageDiv);
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ€ä¸‹éƒ¨ã«
            container.scrollTop = container.scrollHeight;
            
            // ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¿½åŠ 
            chatHistory.push({ sender, content, timestamp: new Date() });
        }

        function showLoading() {
            const container = document.getElementById('chatContainer');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'chat-message ai';
            loadingDiv.innerHTML = `
                <div class="chat-avatar ai">ğŸ¤–</div>
                <div class="loading-indicator active">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            `;
            container.appendChild(loadingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function hideLoading() {
            const loadingDiv = document.getElementById('loadingIndicator');
            if (loadingDiv) {
                loadingDiv.remove();
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.getElementById('guideModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
