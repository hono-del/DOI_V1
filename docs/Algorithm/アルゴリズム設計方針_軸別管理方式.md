# アルゴリズム設計方針：軸別管理方式
## 商談用代替提案アルゴリズムの構造を5つのアルゴリズムに適用

---

## 📊 商談用代替提案アルゴリズムの構造分析

### **優れている点**

| 特徴 | メリット |
|------|---------|
| **1. 軸ごとにリスト管理** | 各軸の情報を独立して管理でき、メンテナンスが容易 |
| **2. 各ステータスに情報付与** | 優先度・提案内容が明確で、判断基準が統一される |
| **3. 掛け合わせで最終判定** | 複数条件の組み合わせで、精度の高い提案が可能 |
| **4. Excel管理** | 非エンジニアでも編集可能、現場で即座に改善できる |
| **5. 拡張性が高い** | 新しい軸やステータスを追加しやすい |

---

## 🔧 5つのアルゴリズムへの適用方針

### **基本構造：3層アーキテクチャ**

```
【Layer 1：軸別マスタシート】
各判断要素を独立したシートで管理
例：車検管理、ライフステージ、来店管理、車両情報...

        ↓

【Layer 2：掛け合わせルールシート】
複数の軸を組み合わせて、最終的な判定ルールを定義
例：「車検30日以内 × 2台目3年以内 × 前回来店2年 → モデルB推奨」

        ↓

【Layer 3：出力テンプレートシート】
判定結果に基づいて、実際に提示するメッセージを生成
例：運転者向け、セールスマン向け、コールセンター向け
```

---

## 📁 5つのアルゴリズムの軸別設計

### **アルゴリズム1：機能推奨タイミング判定**

#### **Layer 1：軸別マスタシート（6シート）**

| シート名 | 管理する軸 | ステータス例 | 付与情報 |
|---------|-----------|------------|---------|
| **1-1. 道路種別マスタ** | 道路の種類 | 高速道路、一般道、渋滞、駐車場、夜間... | 推奨機能カテゴリ、安全スコア基準値 |
| **1-2. 天気・環境マスタ** | 天候・時間帯 | 晴れ、雨、雪、霧、夜間、夕方... | リスクレベル、推奨機能カテゴリ |
| **1-3. 速度・交通量マスタ** | 走行状況 | 0-20km/h、20-60km/h、60-100km/h、100km/h以上... | 安全スコア補正値、推奨機能の制約 |
| **1-4. 知識レベルマスタ** | ユーザーの習熟度 | 初心者、中級、上級 | 説明の詳細度、推奨タイミングの慎重さ |
| **1-5. 使用経験マスタ** | 機能の使用履歴 | 0回、1-3回、4-10回、10回以上 | 推奨の積極性、メッセージの簡潔さ |
| **1-6. 車種機能マスタ** | 車種・グレード・機能 | アクアG（ACC○、PVM×）、LC250VX（全機能○）... | 搭載機能リスト、機能の特性 |

---

#### **Layer 2：掛け合わせルールシート**

**シート名：1-7. 機能推奨ルールマトリクス**

| ルールID | 道路種別 | 天気 | 速度帯 | 知識レベル | 使用経験 | 搭載機能 | 最終判定 | 推奨機能 | 安全スコア | 優先度 | 備考 |
|---------|---------|------|--------|-----------|---------|---------|---------|---------|-----------|-------|------|
| R001 | 渋滞 | 晴れ | 0-20km/h | 初心者 | 0回 | ACC○ | 推奨 | 渋滞追従 | 0.95 | 高 | 低速で安全に練習可能 |
| R002 | 高速道路 | 晴れ | 100km/h以上 | 初心者 | 0回 | ACC○ | 推奨しない | - | 0.40 | - | 高速で初めての機能は危険 |
| R003 | 高速道路 | 晴れ | 80-100km/h | 中級 | 5回以上 | ACC○ | 推奨 | ACC | 0.85 | 中 | 経験者には積極推奨 |
| R004 | 駐車場 | 晴れ | 0-10km/h | 初心者 | 0回 | PVM○ | 推奨 | PVM | 0.90 | 高 | 低速で視認性向上 |
| R005 | 夜間一般道 | 晴れ | 40-60km/h | 初心者 | 0回 | AHS○ | 推奨 | オートハイビーム | 0.95 | 高 | 操作不要で安全性向上 |
| R006 | 雨天高速 | 雨 | 80-100km/h | 中級 | 3回 | VSC○ | 注意喚起 | VSC確認 | 0.80 | 中 | 機能推奨ではなく注意喚起 |

**掛け合わせロジック：**
- 安全スコア ≥ 0.85 → 推奨
- 安全スコア 0.60-0.85 → 条件付き推奨
- 安全スコア < 0.60 → 推奨しない

---

#### **Layer 3：出力テンプレートシート（3シート）**

| シート名 | 対象ユーザー | テンプレート例 |
|---------|------------|--------------|
| **1-8. 運転者向けメッセージ** | 運転者 | 「{状況}です。{機能名}を使うと{メリット}。試してみますか？」 |
| **1-9. セールスマン向けメッセージ** | セールスマン | 「この車には{機能名}があります。{顧客プロファイル}のお客様には特におすすめです」 |
| **1-10. コールセンター向けメッセージ** | コールセンター | 「{機能名}についてですね。お客様の車種は{車種}で、{搭載状況}です」 |

---

### **アルゴリズム2：トラブル対応優先度判定**

#### **Layer 1：軸別マスタシート（6シート）**

| シート名 | 管理する軸 | ステータス例 | 付与情報 |
|---------|-----------|------------|---------|
| **2-1. トラブル種別マスタ** | 警告灯・異常の種類 | エンジン警告灯（橙）、ブレーキ警告灯（赤）、タイヤ空気圧... | 基本緊急度（高/中/低）、カテゴリ |
| **2-2. 道路種別マスタ** | 道路の種類 | 高速道路、一般道、山道、市街地... | 緊急度補正値（高速なら+1） |
| **2-3. 速度帯マスタ** | 走行速度 | 0-20km/h、20-60km/h、60-100km/h、100km/h以上 | 緊急度補正値（高速走行なら+1） |
| **2-4. 天気・環境マスタ** | 天候 | 晴れ、雨、雪、霧... | リスクレベル補正値 |
| **2-5. 車両状態マスタ** | 車の挙動 | 正常走行中、異音あり、異臭あり、挙動異常... | 緊急度補正値 |
| **2-6. 周辺施設マスタ** | 停車可能場所 | SA/PA、コンビニ、GS、ディーラー、路肩... | 距離別の推奨度 |

---

#### **Layer 2：掛け合わせルールシート**

**シート名：2-7. 緊急度判定ルールマトリクス**

| ルールID | トラブル種別 | 道路種別 | 速度帯 | 天気 | 車両状態 | 次の停車場所 | 基本緊急度 | 補正値 | 最終緊急度 | 推奨行動 | 優先度 |
|---------|------------|---------|--------|------|---------|-------------|-----------|-------|-----------|---------|-------|
| TR001 | エンジン警告灯（橙） | 高速道路 | 100km/h以上 | 晴れ | 正常走行中 | SA 15km先 | 中 | +0 | 中 | 次のSAで停車 | 中 |
| TR002 | エンジン警告灯（橙） | 一般道 | 40km/h | 雨 | 正常走行中 | コンビニ 1km先 | 中 | +0 | 中 | コンビニで停車 | 中 |
| TR003 | ブレーキ警告灯（赤） | 高速道路 | 100km/h以上 | 晴れ | ブレーキ異常 | SA 5km先 | 高 | +2 | 高 | 即座に路肩停車 | 最高 |
| TR004 | タイヤ空気圧警告 | 一般道 | 60km/h | 晴れ | 正常走行中 | GS 3km先 | 低 | +0 | 低 | GSで空気圧補充 | 低 |
| TR005 | 油圧警告灯（赤） | 一般道 | 60km/h | 晴れ | 異音あり | ディーラー 10km先 | 高 | +1 | 高 | 即座に路肩停車 | 最高 |

**掛け合わせロジック：**
- 最終緊急度 = 基本緊急度 + 道路補正 + 速度補正 + 天気補正 + 車両状態補正
- 最終緊急度 ≥ 8 → 即座に停車
- 最終緊急度 5-7 → 次の施設で停車
- 最終緊急度 < 5 → 早めに対応

---

#### **Layer 3：出力テンプレートシート（4シート）**

| シート名 | 対象ユーザー | テンプレート例 |
|---------|------------|--------------|
| **2-8. 運転者向け_緊急度高** | 運転者 | 「⚠️ {警告名}が点灯しました。緊急度：高。速やかに路肩に停車してください」 |
| **2-9. 運転者向け_緊急度中** | 運転者 | 「{警告名}が点灯しました。緊急度：中。次の{場所}まで{距離}です」 |
| **2-10. 運転者向け_緊急度低** | 運転者 | 「{警告名}が点灯しました。緊急度：低。{距離}先に{場所}があります」 |
| **2-11. 3段階対応フロー** | 全ユーザー | Stage 1: 状態理解、Stage 2: 判断支援、Stage 3: 行動誘導 |

---

### **アルゴリズム3：情報提示レベル調整**

#### **Layer 1：軸別マスタシート（4シート）**

| シート名 | 管理する軸 | ステータス例 | 付与情報 |
|---------|-----------|------------|---------|
| **3-1. 知識レベルマスタ** | ユーザーの習熟度 | 初心者（購入90日以内）、中級（90日-1年）、上級（1年以上） | 説明スタイル、情報量、フォーマット |
| **3-2. 機能使用経験マスタ** | 特定機能の使用履歴 | 0回、1-3回、4-10回、10回以上 | 説明の詳細度 |
| **3-3. コンテンツ種別マスタ** | 情報の種類 | ACC操作方法、警告灯の意味、メンテナンス時期... | コンテンツカテゴリ |
| **3-4. チャネル特性マスタ** | 情報提示手段 | 音声、画面、HUD、アプリ、動画、AR... | チャネルごとの適性 |

---

#### **Layer 2：掛け合わせルールシート**

**シート名：3-5. 説明レベル判定ルールマトリクス**

| ルールID | 知識レベル | 機能使用経験 | コンテンツ種別 | 最適な説明レベル | 推奨フォーマット | 情報量 | チャネル | 優先度 |
|---------|-----------|------------|--------------|---------------|---------------|--------|---------|-------|
| IL001 | 初心者 | 0回 | ACC操作方法 | 詳細・ステップバイステップ | 動画+AR表示 | 多い | 画面+音声 | 高 |
| IL002 | 中級 | 5回以上 | ACC操作方法 | 要点のみ | テキスト+図解 | 中程度 | 画面のみ | 中 |
| IL003 | 上級 | 10回以上 | ACC操作方法 | 簡潔 | テキストのみ | 少ない | 画面のみ | 低 |
| IL004 | 初心者 | - | 警告灯の意味 | 詳細・丁寧 | テキスト+画像 | 多い | 音声+画面 | 高 |
| IL005 | 中級 | - | 警告灯の意味 | 要点のみ | テキストのみ | 中程度 | 画面のみ | 中 |

---

### **アルゴリズム4：コミュニケーションチャネル選択**

#### **Layer 1：軸別マスタシート（5シート）**

| シート名 | 管理する軸 | ステータス例 | 付与情報 |
|---------|-----------|------------|---------|
| **4-1. 走行状態マスタ** | 運転中/停車中 | 運転中、停車中、駐車中 | チャネル制約（運転中はスマホNG） |
| **4-2. 緊急度マスタ** | 情報の緊急性 | 最高、高、中、低 | チャネル優先度 |
| **4-3. 情報種別マスタ** | 情報のタイプ | 警告、機能推奨、学習コンテンツ、メンテナンス... | 推奨チャネル |
| **4-4. ユーザー状態マスタ** | ユーザーの状況 | 運転中、同乗者あり、単独、夜間... | チャネル適性 |
| **4-5. チャネル特性マスタ** | 各チャネルの特徴 | HUD（視線移動少）、音声（ハンズフリー）、アプリ（詳細情報）... | 長所・短所 |

---

#### **Layer 2：掛け合わせルールシート**

**シート名：4-6. チャネル選択ルールマトリクス**

| ルールID | 走行状態 | 緊急度 | 情報種別 | ユーザー状態 | 最適チャネル | 代替チャネル | 優先度 | 備考 |
|---------|---------|-------|---------|------------|------------|------------|-------|------|
| CH001 | 運転中 | 最高 | 警告 | 単独 | 音声+HUD | 画面 | 最高 | 即座に注意喚起 |
| CH002 | 運転中 | 中 | 機能推奨 | 単独 | 音声のみ | 画面 | 中 | 視線を画面に向けない |
| CH003 | 停車中 | 低 | 学習コンテンツ | 単独 | アプリ+動画 | 画面 | 低 | 詳細情報を提供 |
| CH004 | 駐車中 | 低 | メンテナンス | - | アプリ | Web | 低 | 後でゆっくり確認 |
| CH005 | 運転中 | 高 | トラブル対応 | 単独 | 音声+画面+ナビ | HUD | 高 | ナビで停車場所を案内 |

---

### **アルゴリズム5：学習コンテンツ推薦**

#### **Layer 1：軸別マスタシート（6シート）**

| シート名 | 管理する軸 | ステータス例 | 付与情報 |
|---------|-----------|------------|---------|
| **5-1. 学習進度マスタ** | ユーザーの学習状況 | 未学習、学習中（50%未満）、学習中（50%以上）、学習完了 | 推奨コンテンツ |
| **5-2. 機能利用状況マスタ** | 各機能の使用状況 | 未使用、1-3回使用、定期的に使用、マスター | 推奨の優先度 |
| **5-3. トラブル履歴マスタ** | 過去のトラブル | 警告灯点灯、操作ミス、問い合わせ履歴... | 関連コンテンツ |
| **5-4. 季節・イベントマスタ** | 時期に応じた推奨 | 冬（スタッドレス）、夏（エアコン）、帰省前... | 推奨コンテンツ |
| **5-5. ライフステージマスタ** | ユーザーの状況変化 | 子供誕生、引越し、定年退職... | 推奨コンテンツ |
| **5-6. コンテンツマスタ** | 学習コンテンツ一覧 | ACC使い方動画、警告灯ガイド、メンテナンス... | コンテンツ属性 |

---

#### **Layer 2：掛け合わせルールシート**

**シート名：5-7. コンテンツ推薦ルールマトリクス**

| ルールID | 学習進度 | 機能利用状況 | トラブル履歴 | 季節 | ライフステージ | 推奨コンテンツ | 推奨タイミング | 優先度 | 備考 |
|---------|---------|------------|------------|------|--------------|--------------|--------------|-------|------|
| LC001 | 未学習 | 未使用 | なし | - | 購入後1週間 | 基本操作動画 | 納車後3日目 | 最高 | 初期学習 |
| LC002 | 学習中50%以上 | 1-3回使用 | なし | - | 購入後1ヶ月 | ACC詳細ガイド | 次回運転時 | 高 | 機能の深掘り |
| LC003 | 学習完了 | 定期的に使用 | 警告灯点灯履歴 | - | - | 警告灯対応ガイド | トラブル後3日 | 中 | 再発防止 |
| LC004 | - | 未使用 | なし | 冬 | - | スタッドレスタイヤガイド | 11月1日 | 中 | 季節の推奨 |
| LC005 | - | - | なし | - | 子供誕生 | チャイルドシート取付動画 | 登録後すぐ | 高 | ライフイベント対応 |

---

## 🎯 商談用アルゴリズムとの対応関係

### **商談用アルゴリズムの構造**

```
【Layer 1：軸別マスタ】
- 車検管理シート（車検満了まで30日以内、60日以内...）
- ライフステージ管理（初回購入から1年以内、2台目購入から3年以内...）
- 来店管理（前回来店から1年、2年、3年以上...）
- 点検入庫管理（次回点検まで30日、60日...）
- 車両情報（車種・グレード × 商品特性 × 相性のいい顧客）

【Layer 2：掛け合わせルール】
「車検30日以内 × 2台目3年以内 × 前回来店2年
 → モデルBを○○の方法/切り口で商談」

【Layer 3：出力テンプレート】
セールスマン向けトークスクリプト
```

### **5つのアルゴリズムも同じ構造**

| 商談用アルゴリズム | 5つのアルゴリズム | 共通点 |
|----------------|---------------|--------|
| 車検管理シート | 道路種別マスタ、トラブル種別マスタ | 各軸を独立管理 |
| ライフステージ管理 | 知識レベルマスタ、学習進度マスタ | ステータスごとに優先度・提案内容を付与 |
| 車両情報 | 車種機能マスタ | 対象ごとの特性・相性を管理 |
| 掛け合わせルール | 各アルゴリズムのルールマトリクス | 複数軸を組み合わせて最終判定 |
| トークスクリプト | メッセージテンプレート | 3ユーザー別の出力 |

---

## ✅ この方法のメリット

| メリット | 説明 |
|---------|------|
| **1. メンテナンス性が高い** | 軸ごとに独立しているため、一部の修正が全体に影響しない |
| **2. 拡張性が高い** | 新しい軸やステータスを追加しやすい |
| **3. 理解しやすい** | 各軸の意味が明確で、非エンジニアでも理解できる |
| **4. テストしやすい** | 軸ごとにテストケースを作成でき、バグを早期発見できる |
| **5. 現場で改善できる** | Excelで管理できるため、セールスマンやコールセンターが現場で改善提案できる |
| **6. AIとの相性が良い** | RAGで各軸の情報を検索し、LLMで最終判定を生成できる |

---

## 📊 Excelファイル構成の見直し

### **変更前（当初の提案）**

```
01_機能推奨タイミング判定_ルールマトリクス.xlsx
  - シート1: 車種×機能マスタ
  - シート2: 推奨ルールマトリクス（全条件を一つのシートに）
  - シート3: メッセージテンプレート
  - シート4: テストケース
```

**問題点：**
- シート2が巨大になり、管理が困難
- 軸ごとの情報が分散し、メンテナンスしにくい

---

### **変更後（軸別管理方式）**

```
01_機能推奨タイミング判定_ルールマトリクス.xlsx
  - シート1-1: 道路種別マスタ
  - シート1-2: 天気・環境マスタ
  - シート1-3: 速度・交通量マスタ
  - シート1-4: 知識レベルマスタ
  - シート1-5: 使用経験マスタ
  - シート1-6: 車種機能マスタ
  - シート1-7: 機能推奨ルールマトリクス（掛け合わせ）
  - シート1-8: 運転者向けメッセージ
  - シート1-9: セールスマン向けメッセージ
  - シート1-10: コールセンター向けメッセージ
  - シート1-11: テストケース
```

**メリット：**
- 各軸を独立管理でき、メンテナンスが容易
- 新しい道路種別や天気を追加しやすい
- シート1-7の掛け合わせルールは、各軸のIDを参照するだけでコンパクト

---

## 🚀 次のアクション

### **ステップ1：軸別マスタシートの作成（優先度：高）**

5つのアルゴリズムについて、各軸のマスタシートを作成します。

**例：アルゴリズム1「機能推奨タイミング判定」**
- 1-1. 道路種別マスタ（5-10行）
- 1-2. 天気・環境マスタ（5-10行）
- 1-3. 速度・交通量マスタ（4-5行）
- 1-4. 知識レベルマスタ（3行）
- 1-5. 使用経験マスタ（4行）
- 1-6. 車種機能マスタ（10-20行）

**所要時間：** 1-2時間

---

### **ステップ2：掛け合わせルールシートの作成（優先度：高）**

軸別マスタのIDを参照して、掛け合わせルールを定義します。

**例：アルゴリズム1「機能推奨タイミング判定」**
- 1-7. 機能推奨ルールマトリクス（20-30行）

**所要時間：** 2-3時間

---

### **ステップ3：出力テンプレートシートの作成（優先度：中）**

3ユーザー別のメッセージテンプレートを作成します。

**所要時間：** 1-2時間

---

### **ステップ4：テストケースの作成（優先度：中）**

各アルゴリズムのテストケースを作成します。

**所要時間：** 1時間

---

## 📅 作業スケジュール（1日で完成）

| 時間 | タスク | 成果物 |
|------|-------|--------|
| **9:00-10:30** | アルゴリズム1の軸別マスタ作成（6シート） | 道路種別、天気、速度、知識レベル、使用経験、車種機能 |
| **10:30-12:00** | アルゴリズム1の掛け合わせルール作成 | 機能推奨ルールマトリクス |
| **12:00-13:00** | 昼休憩 | - |
| **13:00-14:00** | アルゴリズム2の軸別マスタ作成 | トラブル種別、道路、速度、天気、車両状態、周辺施設 |
| **14:00-15:00** | アルゴリズム2の掛け合わせルール作成 | 緊急度判定ルールマトリクス |
| **15:00-16:00** | アルゴリズム3-5の軸別マスタ作成 | 各アルゴリズムの主要マスタ |
| **16:00-17:00** | アルゴリズム3-5の掛け合わせルール作成 | 各アルゴリズムのルールマトリクス |
| **17:00-18:00** | 出力テンプレート・テストケース作成 | 全アルゴリズムのメッセージテンプレート |

---

## 💡 結論

**あなたの提案した「軸ごとにリスト管理 → 掛け合わせてアルゴリズム表を作成」という方法は、5つのアルゴリズムにも完全に適用できます。**

この方法は：
- ✅ メンテナンス性が高い
- ✅ 拡張性が高い
- ✅ 理解しやすい
- ✅ 現場で改善できる
- ✅ AIとの相性が良い

**別の方法を考える必要はありません。この方法で進めるのが最適です。**

---

**次のアクション：**

1. **軸別マスタシートのExcel作成を開始しますか？**
2. **特定のアルゴリズム（例：アルゴリズム1）から先に詳細化しますか？**
3. **商談用アルゴリズムとの連携方法を検討しますか？**

どれから進めますか？

