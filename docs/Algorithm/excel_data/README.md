# アルゴリズム1：機能推奨タイミング判定 Excel データ

## 📁 ファイル一覧

このフォルダには、**アルゴリズム1「機能推奨タイミング判定」**のExcelファイルを構成する11個のCSVファイルが含まれています。

### **Layer 1：軸別マスタ（6ファイル）**

| ファイル名 | 内容 | 行数 |
|----------|------|------|
| `1-1_道路種別マスタ.csv` | 道路の種類（渋滞、高速道路、駐車場など） | 7行 |
| `1-2_天気環境マスタ.csv` | 天候・環境（晴れ、雨、雪、夜間など） | 8行 |
| `1-3_速度交通量マスタ.csv` | 速度帯と交通量 | 6行 |
| `1-4_知識レベルマスタ.csv` | ユーザーの習熟度（初心者、中級、上級） | 3行 |
| `1-5_使用経験マスタ.csv` | 機能の使用経験（未使用、1-3回など） | 4行 |
| `1-6_車種機能マスタ.csv` | 車種・グレード別の搭載機能 | 8行 |

### **Layer 2：掛け合わせルール（1ファイル）**

| ファイル名 | 内容 | 行数 |
|----------|------|------|
| `1-7_機能推奨ルールマトリクス.csv` | 複数軸を組み合わせた推奨ルール | 20行 |

### **Layer 3：出力テンプレート（3ファイル）**

| ファイル名 | 内容 | 行数 |
|----------|------|------|
| `1-8_運転者向けメッセージ.csv` | 運転者向けのメッセージテンプレート | 15行 |
| `1-9_セールスマン向けメッセージ.csv` | セールスマン向けのメッセージテンプレート | 15行 |
| `1-10_コールセンター向けメッセージ.csv` | コールセンター向けのメッセージテンプレート | 15行 |

### **テスト（1ファイル）**

| ファイル名 | 内容 | 行数 |
|----------|------|------|
| `1-11_テストケース.csv` | アルゴリズムのテストケース | 15行 |

---

## 📊 Excelファイルの作成方法

### **方法1：Excelで直接開く（推奨）**

1. **新しいExcelファイルを作成**
   - Excelを起動し、新しいブックを作成
   - ファイル名：`01_機能推奨タイミング判定_ルールマトリクス.xlsx`

2. **各CSVファイルをシートとしてインポート**
   
   各CSVファイルについて、以下の手順を繰り返します：
   
   a. **新しいシートを作成**
      - シート名を適切に設定（例：「1-1_道路種別マスタ」）
   
   b. **CSVデータをインポート**
      - 「データ」タブ → 「テキストまたはCSVから」
      - 対象のCSVファイルを選択
      - エンコーディング：UTF-8を選択
      - 区切り記号：カンマ
      - 「読み込み」をクリック
   
   c. **書式を整える**
      - ヘッダー行を太字にする
      - 列幅を自動調整
      - 条件付き書式を設定（後述）

3. **シートの順番を整える**
   - 上記の順番通りにシートを並べる

---

### **方法2：PowerShellスクリプトで一括作成**

以下のPowerShellスクリプトを使用すると、CSVファイルを自動でExcelファイルにまとめることができます。

```powershell
# Excel作成スクリプト
$excel = New-Object -ComObject Excel.Application
$excel.Visible = $false
$workbook = $excel.Workbooks.Add()

# デフォルトのシートを削除
$workbook.Worksheets.Item(1).Delete()

# CSVファイルのリスト
$csvFiles = @(
    "1-1_道路種別マスタ.csv",
    "1-2_天気環境マスタ.csv",
    "1-3_速度交通量マスタ.csv",
    "1-4_知識レベルマスタ.csv",
    "1-5_使用経験マスタ.csv",
    "1-6_車種機能マスタ.csv",
    "1-7_機能推奨ルールマトリクス.csv",
    "1-8_運転者向けメッセージ.csv",
    "1-9_セールスマン向けメッセージ.csv",
    "1-10_コールセンター向けメッセージ.csv",
    "1-11_テストケース.csv"
)

# 各CSVファイルをシートとして追加
foreach ($csvFile in $csvFiles) {
    $csv = Import-Csv -Path $csvFile -Encoding UTF8
    $worksheet = $workbook.Worksheets.Add()
    $worksheet.Name = $csvFile -replace ".csv", ""
    
    # ヘッダーを追加
    $col = 1
    foreach ($header in $csv[0].PSObject.Properties.Name) {
        $worksheet.Cells.Item(1, $col) = $header
        $col++
    }
    
    # データを追加
    $row = 2
    foreach ($item in $csv) {
        $col = 1
        foreach ($prop in $item.PSObject.Properties) {
            $worksheet.Cells.Item($row, $col) = $prop.Value
            $col++
        }
        $row++
    }
}

# ファイルを保存
$workbook.SaveAs("C:\Path\To\01_機能推奨タイミング判定_ルールマトリクス.xlsx")
$excel.Quit()
```

---

## 🎨 条件付き書式の設定

### **1-7_機能推奨ルールマトリクス**

#### **補正後安全スコア列**
- **0.85以上：** 緑色の塗りつぶし
- **0.60-0.85：** 黄色の塗りつぶし
- **0.60未満：** 赤色の塗りつぶし

#### **最終判定列**
- **「推奨」：** 緑色の塗りつぶし
- **「条件付き推奨」：** 黄色の塗りつぶし
- **「推奨しない」：** 赤色の塗りつぶし

#### **優先度列**
- **「最高」：** 濃い赤色
- **「高」：** 赤色
- **「中」：** 黄色
- **「低」：** 灰色

---

## 🔗 データ検証の設定

### **1-7_機能推奨ルールマトリクス**

以下の列にドロップダウンリストを設定します：

| 列名 | ドロップダウンの元データ |
|------|---------------------|
| 道路種別ID | シート「1-1_道路種別マスタ」のA列 |
| 天気環境ID | シート「1-2_天気環境マスタ」のA列 |
| 速度交通量ID | シート「1-3_速度交通量マスタ」のA列 |
| 知識レベルID | シート「1-4_知識レベルマスタ」のA列 |
| 使用経験ID | シート「1-5_使用経験マスタ」のA列 |

**設定方法：**
1. 対象の列を選択
2. 「データ」タブ → 「データの入力規則」
3. 「設定」タブで「リスト」を選択
4. 「元の値」に、参照するシートの範囲を入力
   - 例：`='1-1_道路種別マスタ'!$A$2:$A$8`
5. 「OK」をクリック

---

## 📐 数式の設定

### **1-7_機能推奨ルールマトリクス**

#### **補正後安全スコア列（J列）**

```excel
=I2 + 
VLOOKUP(B2,'1-1_道路種別マスタ'!$A:$E,5,FALSE) + 
VLOOKUP(C2,'1-2_天気環境マスタ'!$A:$E,5,FALSE) + 
VLOOKUP(D2,'1-3_速度交通量マスタ'!$A:$E,5,FALSE)
```

**説明：**
- 基本安全スコア（I列）に、各軸の補正値を加算
- VLOOKUP関数で、各マスタシートから補正値を取得

#### **最終判定列（K列）**

```excel
=IF(J2>=0.85,"推奨",IF(J2>=0.60,"条件付き推奨","推奨しない"))
```

**説明：**
- 補正後安全スコアが0.85以上なら「推奨」
- 0.60～0.85なら「条件付き推奨」
- 0.60未満なら「推奨しない」

---

## 🔒 シート保護の設定

### **推奨設定**

| シート名 | 保護設定 | 理由 |
|---------|---------|------|
| 1-1～1-6（マスタシート） | 保護（承認者のみ編集可） | マスタデータは慎重に管理 |
| 1-7（ルールマトリクス） | 保護なし（チーム全体で編集可） | ルールは随時追加・修正 |
| 1-8～1-10（メッセージ） | 保護なし | メッセージは随時改善 |
| 1-11（テストケース） | 保護なし | 誰でも追加可能 |

**保護方法：**
1. 対象のシートを選択
2. 「校閲」タブ → 「シートの保護」
3. パスワードを設定（オプション）
4. 「OK」をクリック

---

## 📝 使い方

### **1. 新しいルールを追加する**

**シート：1-7_機能推奨ルールマトリクス**

1. 最終行の次の行に新しいルールIDを入力
2. 各列のドロップダウンリストから適切な値を選択
3. 基本安全スコアを入力（補正後安全スコアは自動計算される）
4. 備考欄に補足情報を入力

### **2. 新しい道路種別を追加する**

**シート：1-1_道路種別マスタ**

1. 最終行の次の行に新しい道路種別IDを入力
2. 道路種別名、説明、推奨機能カテゴリなどを入力
3. シート「1-7」のドロップダウンリストに自動で反映される

### **3. テストケースを実行する**

**シート：1-11_テストケース**

1. 各テストケースの入力条件を確認
2. シート「1-7」のルールマトリクスで該当するルールを検索
3. 期待される出力と実際の出力を比較
4. 判定列に「PASS」または「FAIL」を入力

---

## 🎯 活用例

### **例1：渋滞時の初心者に渋滞追従機能を推奨する**

**ルールマトリクスの設定：**
- 道路種別ID：ROAD_001（渋滞）
- 天気環境ID：WEATHER_001（晴れ）
- 速度交通量ID：SPEED_001（0-20km/h、多い）
- 知識レベルID：LEVEL_001（初心者）
- 使用経験ID：EXP_001（未使用）
- 必要機能：ACC
- 推奨機能：渋滞追従
- 基本安全スコア：0.90
- **補正後安全スコア：1.00**（自動計算）
- **最終判定：推奨**（自動計算）

**運転者向けメッセージ：**
「渋滞が始まりました。渋滞追従機能を使うと、ブレーキとアクセルの操作が自動化され、疲労が軽減されます。低速で安全に練習できます。試してみますか？」

---

### **例2：高速道路で初心者にACCを推奨しない**

**ルールマトリクスの設定：**
- 道路種別ID：ROAD_002（高速道路）
- 天気環境ID：WEATHER_001（晴れ）
- 速度交通量ID：SPEED_006（100km/h以上、少ない）
- 知識レベルID：LEVEL_001（初心者）
- 使用経験ID：EXP_001（未使用）
- 必要機能：ACC
- 推奨機能：-（推奨しない）
- 基本安全スコア：0.80
- **補正後安全スコア：0.50**（自動計算）
- **最終判定：推奨しない**（自動計算）

**理由：**
高速で初めての機能を使うのは危険なため、推奨しない。

---

## 🔄 今後の拡張

### **追加予定のマスタ**
- **ライフステージマスタ：** 子供誕生、引越し、定年退職など
- **季節イベントマスタ：** 帰省、旅行、雪道走行など
- **車両状態マスタ：** メンテナンス時期、走行距離など

### **追加予定の機能**
- **学習履歴の反映：** ユーザーの学習進度に応じた推奨
- **外部データ連携：** 天気API、地図APIとの連携
- **AI判定：** RAG基盤と連携した自動判定

---

## 📞 お問い合わせ

このExcelファイルに関する質問や改善提案があれば、プロジェクトチームまでご連絡ください。

---

**作成日：** 2026年1月13日  
**バージョン：** 1.0  
**作成者：** CMC Corporation

