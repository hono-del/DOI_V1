# シンプルフロー入力テンプレート

## コンセプト

**1つのMarkdownファイルにフロー情報を記述するだけで、必要なCSVとフロー図を自動生成します。**

---

## 入力形式: `flow_input.md`

```markdown
# テーマ: スマートキーでドアが開かない

## 基本情報
- **テーマID**: THEME-001
- **緊急度**: high
- **主要インテント**: I1, I3, I4
- **フェーズ構成**: 初期診断 → 原因特定 → 対応実施 → 検証 → 解決

---

## フロー定義

### 1. 開始
**[START]** ドアが開かない
- 状態: ユーザーがスマートキーでドアを開けようとしたが反応しない
- 次: インジケーター確認へ

---

### 2. インジケーター確認
**[CHECK]** スマートキーのインジケーターは点灯しますか?
- 選択肢:
  - 点灯しない → キー電池切れ疑い
  - 点灯する → 車両側問題疑い

---

### 3-A. キー電池切れ疑い (電池切れルート)
**[NODE]** キー電池切れの可能性が高い
- 状態: インジケーター不点灯から電池切れを疑う
- 次: ユーザー意図確認へ

**[CHECK]** どうしたいですか?
- 選択肢:
  - すぐに開けたい → 機械キー使用へ
  - 電池交換したい → 電池交換実施へ

---

### 3-A-1. 機械キールート
**[NODE]** 機械キーで開錠する
- アクション: 機械キーの使用を決定
- ガイド: GUIDE-001 (機械キーの取り出し方)
- 次: 機械キー所持確認へ

**[CHECK]** 機械キーを持っていますか?
- 選択肢:
  - 持っている → 機械キー開錠実施へ
  - 持っていない → 機械キー未所持へ

**[NODE]** 機械キー開錠実施
- アクション: 実際に機械キーで開錠を試みる
- 次: 開錠成功確認へ

**[CHECK]** 機械キーで開きましたか?
- 選択肢:
  - 開いた → 解決へ
  - 開かなかった → ドアロック故障疑いへ

**[NODE]** 機械キー未所持
- 問題: 機械キーを持っていない
- ガイド: GUIDE-002 (機械キーの場所・保管方法)
- 次: ロードサービスへ

---

### 3-A-2. 電池交換ルート
**[NODE]** 電池交換実施
- アクション: スマートキーの電池を交換する
- ガイド: GUIDE-KEY-BATTERY (電池交換手順)
- 次: 電池交換効果確認へ

**[CHECK]** 電池交換後、問題は解決しましたか?
- 選択肢:
  - 解決した → 解決へ
  - まだ開かない → 電池交換でも未解決へ

**[NODE]** 電池交換でも未解決
- 診断: 電池交換後も問題が続く
- 次: 車両診断へ

**[CHECK]** 車両の電装品(ライト等)は動作しますか?
- 選択肢:
  - 動作しない → バッテリー上がりへ
  - 動作する → 電波干渉診断へ

---

### 3-B. 車両側問題疑い (車両側ルート)
**[NODE]** 車両側の問題の可能性
- 状態: インジケーター点灯から車両側の問題を疑う
- 次: 車両診断へ

**[CHECK]** 車両の電装品(ライト等)は動作しますか?
- 選択肢:
  - 動作しない → バッテリー上がりへ
  - 動作する → 電波干渉診断へ

---

### 4. バッテリー上がりルート
**[NODE]** バッテリー上がり
- 診断: 車両バッテリーの問題と判断
- 次: ジャンプ可否確認へ

**[CHECK]** ジャンプスタートできる環境ですか?
- 選択肢:
  - できる → ジャンプスタート手順へ (GUIDE)
  - できない → ロードサービスへ

**[GUIDE]** GUIDE-007
- 内容: ジャンプスタート手順の案内
- 次: (終了)

---

### 5. 電波干渉診断ルート
**[NODE]** 電波干渉診断
- 診断: 電波干渉の可能性を確認
- 次: 電波干渉環境確認へ

**[CHECK]** 強い電波を発する施設(空港・放送局等)の近くですか?
- 選択肢:
  - 近くにいる → 電波干渉対応へ
  - そうではない → その他の診断へ

**[NODE]** 電波干渉対応
- アクション: 電波干渉への対応を実施
- ガイド: GUIDE-RADIO-INTERFERENCE (キーを車体に近づける方法)
- 次: 電波干渉対応効果確認へ

**[CHECK]** キーを車体に近づけたら解決しましたか?
- 選択肢:
  - 解決した → 解決へ
  - 解決しない → その他の診断へ

---

### 6. その他診断ルート
**[NODE]** その他の診断
- 診断: 他の原因を探る
- 次: 代替キー確認へ

**[CHECK]** 予備のキーはありますか?
- 選択肢:
  - ある → 代替キー使用へ
  - ない → ドアロック故障疑いへ

**[NODE]** 代替キー使用
- アクション: 予備のキーで試す
- 次: 代替キー効果確認へ

**[CHECK]** 予備のキーで解決しましたか?
- 選択肢:
  - 解決した → 元のキー故障へ
  - 解決しない → ドアロック故障疑いへ

**[NODE]** 元のキー故障
- 診断: 使用していたキーの故障と判断
- ガイド: GUIDE-009 (キー修理・交換手続き)
- 次: (終了)

---

### 7. 終端ノード
**[NODE]** ドアロック故障疑い
- 問題: ドアロック機構の故障を疑う
- ガイド: GUIDE-010 (ドアロック故障時の対応)
- 次: ロードサービスへ

**[NODE]** ロードサービス
- エスカレーション: 専門家に依頼
- ガイド: GUIDE-EMERGENCY-SERVICE (ロードサービス連絡先)
- 次: (終了)

**[NODE]** 解決
- 成功: 問題が解決した
- ガイド: GUIDE-013 (予防策・定期点検の案内)
- 次: (終了)
```

---

## この形式のメリット

### ✅ **1ファイルで完結**
- フロー全体を1つのファイルで管理
- エッジの接続が視覚的に理解しやすい

### ✅ **人間が読みやすい**
- Markdownなので誰でも編集可能
- フローの全体像が一目瞭然

### ✅ **自動変換可能**
- このファイルから8つのCSV(または4つの簡易版CSV)を自動生成
- フロー図(Mermaid/HTML)も自動生成

### ✅ **バージョン管理しやすい**
- Gitで差分が見やすい
- レビューしやすい

---

## 自動生成されるファイル

このMarkdownファイルから以下を自動生成:

1. **CSVファイル** (必要最小限の3-5個)
   - `Theme.csv` - テーマ情報
   - `Nodes.csv` - すべてのノード(START/CHECK/NODE/GUIDE)
   - `Edges.csv` - すべての遷移
   - `Guides.csv` - ガイドコンテンツ

2. **フロー図**
   - `flow_diagram.html` - インタラクティブなフロー図
   - `flow_mermaid.md` - Mermaid形式のフロー図

3. **ドキュメント**
   - `flow_analysis.md` - フロー分析レポート
   - `coverage_report.md` - カバレッジレポート

---

## ノード記法

### `[START]` - 開始ノード
```markdown
**[START]** ドアが開かない
- 状態: 説明
- 次: 次のノードへ
```

### `[CHECK]` - 判定ノード
```markdown
**[CHECK]** 質問文?
- 選択肢:
  - 選択肢1 → 次のノード1
  - 選択肢2 → 次のノード2
```

### `[NODE]` - 処理ノード
```markdown
**[NODE]** ノード名
- 状態/アクション/診断/問題/成功: 説明
- ガイド: GUIDE-ID (説明) ← オプション
- 次: 次のノードへ
```

### `[GUIDE]` - ガイドノード
```markdown
**[GUIDE]** GUIDE-ID
- 内容: ガイド内容の説明
- 次: (終了) or 次のノードへ
```

---

## 次のステップ

1. このテンプレートをコピーして、新しいテーマのフローを記述
2. `generate_flow_from_md.py`を実行
3. CSVとフロー図が自動生成される

---

## 例: 他のテーマ

### テーマ: ブレーキ警告灯が点灯

```markdown
# テーマ: ブレーキ警告灯が点灯

## 基本情報
- **テーマID**: THEME-002
- **緊急度**: high
- **主要インテント**: I4, I5
- **フェーズ構成**: 初期診断 → 安全確認 → 対応判断 → エスカレーション

---

## フロー定義

### 1. 開始
**[START]** ブレーキ警告灯が点灯している
- 状態: 走行中にブレーキ警告灯が点灯
- 次: パーキングブレーキ確認へ

### 2. パーキングブレーキ確認
**[CHECK]** パーキングブレーキは解除されていますか?
- 選択肢:
  - 解除されている → ブレーキ液確認へ
  - かかっている → パーキングブレーキ解除へ

### 3. パーキングブレーキ解除
**[NODE]** パーキングブレーキを解除する
- アクション: パーキングブレーキを完全に解除
- ガイド: GUIDE-PARKING-BRAKE (解除方法)
- 次: 解決へ

... (続く)
```

---

## 質問

このシンプルな形式で良いですか?
それとも、さらに簡略化した形式が良いですか?
