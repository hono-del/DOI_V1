# THEME-001 ガイドとXML取扱説明書の紐付け

## 概要

THEME-001「スマートキーでドアが開かない」のガイドコンテンツと、`docs/xml_aqua/`配下のXML取扱説明書データを紐付けます。

---

## XMLファイル構成

### 確認済みファイル

| ファイル名 | チャプター | 内容推定 |
|:-----------|:-----------|:---------|
| M52P95tojpjavhch01.xml | 第1章 | 安全・安心のために |
| M52P95tojpjavhch02.xml | 第2章 | 走行に関する情報表示（警告灯含む） |
| M52P95tojpjavhch03.xml | 第3章 | スマートエントリー関連（推定） |
| M52P95tojpjavhch04.xml | 第4章 | 操作・使い方 |
| M52P95tojpjavhch05.xml | 第5章 | 車内装備 |
| M52P95tojpjavhch06.xml | 第6章 | メンテナンス |
| M52P95tojpjavhch07.xml | 第7章 | トラブルシューティング |
| M52P95tojpjavhch08.xml | 第8章 | 車両情報・仕様 |

### その他ファイル

- M52P95tojpjavhin*.xml: インデックス・索引
- M52P95tojpjavhix*.xml: 索引
- M52P95tojpjavhax*.xml: 付録
- M52P95tojpjavhil*.xml: イラスト情報

---

## THEME-001ガイド一覧

### 実践版で追加されたガイド

| ガイドID | タイトル | 対応XMLファイル（推定） | XML内セクション（推定） |
|:---------|:---------|:----------------------|:----------------------|
| GUIDE-001 | 機械キーの取り出し方 | M52P95tojpjavhch03.xml | スマートエントリー＞キー操作 |
| GUIDE-002 | 機械キーの場所・保管方法 | M52P95tojpjavhch03.xml | スマートエントリー＞キー管理 |
| GUIDE-003 | 事前準備物（ドライバー・CR2450電池） | M52P95tojpjavhch06.xml または ch03.xml | メンテナンス＞電池交換 |
| GUIDE-004 | 電池購入方法（オンライン・店舗検索） | ※XMLには未掲載（システム側で実装） | - |
| GUIDE-005 | 電池交換手順（部品破損注意） | M52P95tojpjavhch06.xml または ch03.xml | メンテナンス＞電池交換手順 |
| GUIDE-006 | 販売店予約・連絡先 | ※XMLには未掲載（システム側で実装） | - |
| GUIDE-007 | ジャンプスタート手順 | M52P95tojpjavhch07.xml | トラブル＞バッテリー上がり |
| GUIDE-008 | 電波干渉時の対応（キーを近づける） | M52P95tojpjavhch03.xml または ch07.xml | スマートエントリー＞トラブル |
| GUIDE-009 | キー修理・交換手続き | M52P95tojpjavhch06.xml または ch03.xml | メンテナンス＞キー |
| GUIDE-010 | ドアロック故障時の対応 | M52P95tojpjavhch07.xml | トラブル＞ドアロック |
| GUIDE-011 | ロードサービス連絡先・依頼方法 | M52P95tojpjavhch07.xml | トラブル＞緊急時対応 |
| GUIDE-012 | 販売店連絡先・営業時間 | ※XMLには未掲載（システム側で実装） | - |
| GUIDE-013 | 予防策・定期点検の案内 | M52P95tojpjavhch06.xml | メンテナンス＞定期点検 |

---

## 詳細マッピング方針

### 優先度1: 機械キー関連（GUIDE-001, GUIDE-002）

**想定XML**: `M52P95tojpjavhch03.xml`

**検索キーワード**:
- 機械キー
- メカニカルキー
- 内蔵キー
- キー取り出し
- key
- mechanical

**必要情報**:
1. ✅ 機械キーの取り出し手順（イラスト付き）
2. ✅ 保管推奨場所
3. ✅ 注意事項

---

### 優先度2: 電池交換関連（GUIDE-003, GUIDE-005）

**想定XML**: `M52P95tojpjavhch06.xml` (メンテナンス章) または `M52P95tojpjavhch03.xml`

**検索キーワード**:
- 電池交換
- CR2450
- リチウム電池
- マイナスドライバー
- 事前準備
- 交換手順

**取扱説明書の記載内容**（既知）:
```
電池が消耗しているときは、新しい電池に交換してください。
電池はご自身で交換できますが、部品が破損するおそれがあるので、
トヨタ販売店で交換することをおすすめします。

事前に準備するもの:
- マイナスドライバー
- 小さいマイナスドライバー
- リチウム電池: CR2450

電池の入手:
電池はトヨタ販売店・時計店およびカメラ店などで購入できます。
```

**必要情報**:
1. ✅ 事前準備物リスト
2. ✅ 電池型番（CR2450）
3. ✅ 交換手順（ステップバイステップ）
4. ✅ イラスト・図解
5. ✅ 注意事項（部品破損リスク）

---

### 優先度3: トラブルシューティング関連（GUIDE-007, GUIDE-008, GUIDE-010）

**想定XML**: `M52P95tojpjavhch07.xml` (トラブルシューティング章)

**検索キーワード**:
- バッテリー上がり
- ジャンプスタート
- 電波干渉
- ドアロック故障
- スマートエントリー 作動しない
- 開かない

**必要情報**:
1. ✅ バッテリー上がり時の対処法
2. ✅ ジャンプスタート手順
3. ✅ 電波干渉時の対応
4. ✅ ドアロック故障診断

---

### 優先度4: メンテナンス関連（GUIDE-009, GUIDE-013）

**想定XML**: `M52P95tojpjavhch06.xml` (メンテナンス章)

**検索キーワード**:
- キー修理
- キー交換
- 定期点検
- 予防策
- メンテナンス

**必要情報**:
1. ✅ キー修理・交換の依頼方法
2. ✅ 定期点検項目
3. ✅ 予防策

---

## システム側で実装すべきガイド

以下のガイドはXMLには記載がなく、システム側で動的に生成する必要があります。

### GUIDE-004: 電池購入方法

**実装内容**:
1. **オンライン購入**
   - Amazon検索リンク: `https://amazon.co.jp/s?k=CR2450`
   - 楽天市場検索リンク: `https://search.rakuten.co.jp/search?k=CR2450`
   - 価格帯表示: ¥200-500

2. **近くの店舗検索**
   - 位置情報サービス連携
   - 店舗種別:
     - トヨタ販売店
     - 時計店
     - カメラ店
     - 家電量販店
     - コンビニエンスストア
   - 検索半径: 5km

3. **在庫確認機能（拡張）**
   - API連携（将来実装）

---

### GUIDE-006: 販売店予約・連絡先

**実装内容**:
1. **予約フォーム**
   - 位置情報から最寄りの販売店を検索
   - オンライン予約フォーム表示
   - トヨタ公式予約ページへのリンク: `https://toyota.jp/service/reserve`

2. **電話発信**
   - 最寄り販売店の電話番号表示
   - ワンタップ発信機能（モバイル）

3. **営業時間表示**
   - 平日: 9:00-18:00
   - 土曜日: 9:00-17:00
   - 日曜日: 定休日（※店舗により異なる）

---

### GUIDE-012: 販売店連絡先・営業時間

**実装内容**:
GUIDE-006と同様の内容だが、より一般的な販売店情報を提供。

1. **店舗検索**
   - 地域別販売店リスト
   - 地図表示
   - ルート案内

2. **サービス内容**
   - 点検・修理
   - 部品交換
   - 緊急対応

---

## 次のアクション

### ステップ1: XML詳細解析

各XMLファイルから実際のコンテンツを抽出:

```bash
# 機械キー関連を検索
grep -i "機械キー\|mechanical\|内蔵キー" M52P95tojpjavhch03.xml

# 電池交換関連を検索
grep -i "電池交換\|CR2450\|リチウム電池" M52P95tojpjavhch*.xml

# トラブルシューティング関連を検索
grep -i "バッテリー上がり\|ジャンプ\|電波干渉" M52P95tojpjavhch07.xml
```

### ステップ2: L1データ構造設計

抽出したXMLコンテンツをL1データ（取扱情報層）として構造化:

```json
{
  "guide_id": "GUIDE-001",
  "title": "機械キーの取り出し方",
  "source_xml": "M52P95tojpjavhch03.xml",
  "source_section": "ch03se0204010302",
  "content": {
    "steps": [
      "ステップ1: ...",
      "ステップ2: ..."
    ],
    "illustrations": [
      "image_id_001.eps",
      "image_id_002.eps"
    ],
    "warnings": [
      "注意事項1",
      "注意事項2"
    ]
  },
  "related_guides": ["GUIDE-002", "GUIDE-008"],
  "keywords": ["機械キー", "取り出し", "スマートキー"]
}
```

### ステップ3: RAGシステム連携

1. XML→L1データ変換スクリプト作成
2. L1データをベクトルDB化
3. L3（AIガイド層）からのクエリに対してRAG検索
4. 最適なガイドコンテンツを動的生成

---

## XMLパース方針

### XML構造（推定）

```xml
<chapter id="ch03">
  <title>操作方法</title>
  <section id="ch03se01">
    <title>スマートエントリー</title>
    <subsection id="ch03se010401">
      <title>キーの使い方</title>
      <topic id="ch03se01040102">
        <title>機械キーの取り出し</title>
        <basic_operation>
          <step>...</step>
          <fig><image href="..." /></fig>
        </basic_operation>
      </topic>
    </subsection>
  </section>
</chapter>
```

### 抽出すべき要素

1. `<title>`: セクションタイトル
2. `<step>` / `<stepitem>`: 手順
3. `<fig>` / `<image>`: イラスト・図解
4. `<attention>`: 注意事項
5. `<note>`: 補足情報
6. `<p>` / `<itemtxt>`: 本文・説明文

---

## まとめ

### 紐付け完了率

- ✅ **XML推定マッピング**: 100% (全13ガイド)
- ⬜ **XML実データ確認**: 0% (次ステップ)
- ⬜ **L1データ変換**: 0% (次ステップ)
- ⬜ **RAG連携**: 0% (次ステップ)

### システム実装必要度

| ガイドID | XML参照 | システム実装 | 優先度 |
|:---------|:--------|:------------|:-------|
| GUIDE-001 | ✅ | - | 高 |
| GUIDE-002 | ✅ | - | 高 |
| GUIDE-003 | ✅ | - | 高 |
| GUIDE-004 | - | ✅ | 高 |
| GUIDE-005 | ✅ | - | 高 |
| GUIDE-006 | - | ✅ | 高 |
| GUIDE-007 | ✅ | - | 中 |
| GUIDE-008 | ✅ | - | 中 |
| GUIDE-009 | ✅ | - | 低 |
| GUIDE-010 | ✅ | - | 中 |
| GUIDE-011 | ✅ | ✅ | 高 |
| GUIDE-012 | - | ✅ | 中 |
| GUIDE-013 | ✅ | - | 低 |

**XML参照ガイド**: 10個 (77%)  
**システム実装ガイド**: 3個 (23%)

---

## 次回作業

1. ✅ **XMLファイルの詳細解析**: 各章の構造とコンテンツを確認
2. ✅ **実データ抽出スクリプト作成**: Python/XPath で必要情報を抽出
3. ✅ **L1データスキーマ設計**: JSON形式でガイドコンテンツを構造化
4. ✅ **サンプルガイド作成**: GUIDE-001を実装してみる

この紐付けにより、取扱説明書の正確な情報をユーザージャーニーに統合できます!
