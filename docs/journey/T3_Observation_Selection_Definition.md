# T3：観察点選定（Next Best Question）

## T3の定義（採用版）

**T3の役割は、  
事象（T1の出力）と原因候補（T2の出力）に基づき、  
「次に何を確認すれば原因が一気に絞れるか」を1問にまとめ、  
質問UIとして出すこと。**

---

## 1. T3の目的

T3は原因を断定する工程ではありません。  
ユーザーに聞くべき観察を **1問に絞り**、  
原因候補の分布を最も割れる質問を選ぶ **「観察の肩代わり」** を担います。

- 情報利得最大化：候補原因の分布を最も割れる質問を選ぶ
- 禁則適用：危険・難しい・曖昧な質問は除外
- UXには「質問1問」だけを出す（T3＝質問UIの中身）

---

## 2. T3 Input（入力）

T3が受け取るのは、T1の出力、T2の出力、および因果・観測のメタ情報です。

### 2.1 事象情報（T1出力）
- event_id：事象テーマID
- confidence、urgency、context_labels
- （必要に応じて）subtype（警告灯の種類など）

### 2.2 原因候補（T2出力）
- cause_candidates[]：T2が列挙した原因候補リスト

### 2.3 因果構造（知識）
- 故障木・トラブルシュート表
- 事象と原因候補の対応、観察と原因の対応関係

### 2.4 観測手段の制約
- センサー有無（車両側で取れるデータか）
- ユーザー確認可能か（目視・操作で答えられるか）
- 写真・数値・Yes/No のどれが現実的か

### 2.5 ユーザー負荷条件
- 急いでいる／落ち着いている
- 不安が高い／初心者
- 走行中／停止中（警告灯などで質問順が変わる）

---

## 3. T3 Process（処理）

T3の処理は「聞くべき1問の選定」です。

1. 事象に紐づく原因候補（T2の出力）を取得
2. 各候補質問の「情報利得」を評価（原因分布をどれだけ割れるか）
3. 禁則チェック（危険・曖昧・負荷過大の質問を除外）
4. 緊急度・文脈に応じた質問順の調整（例：警告灯は色・点滅を最優先）
5. 1問を選び、question_text / answer_type / expected_split を生成

---

## 4. T3 Output（出力）

T3は「質問UI」の仕様を出力します。

### 4.1 基本出力項目

- question_id：質問の一意識別子
- question_text：ユーザーに表示する質問文
- answer_type：Yes/No、選択肢、数値、写真 等
- expected_split：この質問の回答が原因候補をどう分割するか（T4で利用）
- （必要なら）priority：表示順・緊急時の並び順

### 4.2 出力例

```json
{
  "question_id": "Q_DOOR_001",
  "question_text": "スマートキーのボタンを押すとランプは点きますか？",
  "answer_type": "yes_no",
  "expected_split": {
    "yes": ["RADIO_INTERFERENCE", "VEHICLE_12V_LOW", "USER_OPERATION"],
    "no": ["KEY_BATTERY_EMPTY", "KEY_FAULT"]
  },
  "priority": 1
}
```

---

## 5. T3でやらないこと

- 原因の断定
- 複数質問を同時に出す（1問に絞る）
- ユーザーが答えられない・危険を伴う質問
- 曖昧で解釈が分かれる質問文

T3は診断ではなく、**観察点の選定**です。

---

## 6. 一文サマリ

**T3とは、  
事象と原因候補（T2）に基づき「次に確認すべき1問」を選び、  
質問UIとして出すための観察点選定である。**
