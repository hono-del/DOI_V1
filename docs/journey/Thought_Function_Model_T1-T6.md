# 思考機能モデル（T1〜T6）設計整理

---

## 4. 思考を「6つの機能」に分解する

トラブル対応における人間の思考は、ほぼこの6つに分解できます。

| 思考機能ID | 人がやっていること | AIが肩代わりできるか | 実行順 |
|---|---|---|---|
| T1 | 事象を切り出す | ◎ | 1 |
| T2 | 原因候補を列挙する | ◎ | 2 |
| T3 | 観察すべき点を決める | ◎ | 3 |
| T4 | 仮説を評価・順位付けする | ◎ | 4 |
| T5 | 最適行動を選ぶ | ○ | 5 |
| T6 | 結果を評価し次を決める | ○ | 6 |

---

## 5. 各思考機能を I/O で整理する（超重要）

### T1：事象切り出し（F0相当）

**Input**
- 操作ログ
- ユーザー選択

**Process**
- パターンマッチ
- 異常度スコア

**Output**
- 事象ID（例：DOOR_NOT_OPEN）

👉 人は「なんかおかしい」と思っているだけ  
👉 AIは **ラベル化**

---

### T2：原因候補列挙（F2）

**Input**
- 事象ID
- 車種・仕様

**Process**
- 知識グラフ探索

**Output**
- 原因候補リスト（非表示）

👉 UXには出さない  
👉 **AI内部構造**

---

### T3：観察点選定（F1の本質）

**Input**
- 事象ID
- 原因候補（T2の出力）
- 既知の因果構造

**Process**
- 情報利得最大化
- 不要な質問除外

**Output**
- 質問1問（Yes/No）

👉 人は「何を見ればいい？」を考える  
👉 AIは **聞くべき1問を選ぶ**

---

### T4：仮説評価・順位付け（F3）

**Input**
- 観察結果
- 過去統計

**Process**
- スコアリング

**Output**
- 原因仮説＋確信度

👉 人は「たぶんこれ」と思う  
👉 AIは **数値で持つ**

---

### T5：行動選択（F4）

**Input**
- 仮説
- ユーザー文脈

**Process**
- リスク×即効性×負荷

**Output**
- 行動選択肢（最大3）

👉 人は迷う  
👉 AIは **選択肢を制限**

---

### T6：結果評価・分岐（F6/F7）

**Input**
- 実行結果

**Process**
- 成功判定

**Output**
- 完了 or 次のT3

---

## 0. 前提：T1〜T6は「いつ何を入れて、何を出すか」を決める枠

- T1：事象切り出し（F0相当）  
- T2：原因候補列挙（F2：内部）  
- T3：観察点選定（F1を作る）  
- T4：仮説評価・順位付け（F3：内部）  
- T5：行動選択（F4：UXに出す）  
- T6：結果評価・再探索（F6/F7）  

**番号順＝実行順**（T1→T2→T3→T4→T5→T6）。  
重要なのは、**UXに見せるのは主にT3とT5で、T2/T4は基本“裏側”**です。

---

## 1. 思考機能ごとのI/Oテンプレ（共通）

### T1：事象切り出し（Event Detection / Labeling）

**目的**  
バラバラな兆候から「何が起きたっぽいか」を1つの事象IDに落とす

**Input（いつ）**
- UI入力（困りごと選択 / 自由入力）
- 操作ログ（失敗の連続、設定画面の往復、検索など）
- 文脈（時間帯、位置、走行中/停止中 等）

**Process**
- ルール + 軽い分類（キーワード/意図分類/失敗パターン）
- “確度スコア”算出（0〜1）

**Output**
- event_id（例：DOOR_NOT_OPEN）
- confidence
- urgency（緊急度）
- context_snapshot（後工程に渡す最小文脈）

---

### T2：原因候補列挙（Candidate Generation）

**目的**  
あり得る原因を全部出す（ただしUXには基本出さない）

**Input**
- event_id
- 車種/年式/グレード/地域仕様
- 過去履歴（直近の故障、交換、利用状況）

**Process**
- 知識ベース検索（マニュアル、FAQ、整備要領、統計）
- 条件でフィルタ（その車には存在しない原因を落とす）

**Output**
- cause_candidates[]（原因ID、説明、必要観察、危険度、対処群）

---

### T3：観察点選定（Next Best Question）

**目的**  
「次に何を確認すれば原因が一気に絞れるか」を1問にする  
（＝“質問UI”の中身）

**Input（いつ）**
- event_id
- cause_candidates[]（T2の出力）
- 既知の因果構造（故障木・トラブルシュート表）
- 取得可能な観測手段（センサー無し/あり、ユーザー確認可能か）
- ユーザー負荷条件（急いでる/不安/初心者）

**Process**
- 情報利得最大化（候補原因の分布を最も割れる質問を選ぶ）
- “禁則”適用（危険/難しい/曖昧な質問は除外）

**Output**
- question_id
- question_text
- answer_type（Yes/No、選択肢、数値、写真 等）
- expected_split（この質問が原因候補をどう分割するか）

---

### T4：仮説評価・順位付け（Scoring / Bayesian Update）

**目的**  
観察結果が入るたびに、原因の確率を更新して順位付け

**Input**
- cause_candidates[]（T2の出力）
- 観察回答（T3の結果）
- 追加ログ（失敗回数、環境、再現性）

**Process**
- スコアリング（例：事前確率 × 条件一致）
- しきい値判定（確信度が十分なら次は対処へ）

**Output**
- ranked_causes[]（原因ID、確信度、根拠）
- status（MORE_OBSERVATION / READY_FOR_ACTION / ESCALATE）

---

### T5：行動選択（Action Planning / Decision Support）

**目的**  
ユーザーに出す「次に何をするか」を最大3つに絞る  
（ここが“肩代わり”の体感ポイント）

**Input**
- ranked_causes[] 上位
- 文脈（今すぐ/安全優先/屋外/深夜）
- ユーザープロファイル（DIY可否、過去の選好）
- リスク情報（破損、感電、運転リスク 等）

**Process**
- 目的関数：即効性×安全×負荷×成功率 を最適化
- “一次解決”と“恒久対応”を分けて提示

**Output**
- action_cards[]（手順、所要時間、必要物、危険注意、代替案）
- escalation_option（電話/予約/ロードサービス）

---

### T6：結果評価・再探索（Outcome & Loop）

**目的**  
解決したか/してないかを最短で確認し、次の一手へ自動遷移

**Input**
- action_result（成功/失敗/不明）
- 追加観察（実施後の状態）

**Process**
- 成功判定、失敗時の原因分布再更新（T4へ戻す）
- 失敗が続く場合は早めにエスカレーション

**Output**
- resolved true/false
- next_question（T3へ）
- handoff_payload（専門家に渡す要約：何を試したか、結果）

---

## 2. 3事例での具体例（I/Oを“実際の中身”として書く）

以下、同じT1〜T6が、それぞれのテーマでどう具体化されるかです。

---

### A) 「ドアが開かない」（スマートキー想定）

#### T1（事象切り出し）

**Input例**
- ユーザー：困りごと「ドアが開かない」をタップ
- 操作ログ：解錠ボタン3回/20秒、解錠失敗2回

**Process**
- ルール：unlock_fail >= 2 within 30s → DOOR_NOT_OPEN 高確度

**Output例**
- event_id=DOOR_NOT_OPEN
- confidence=0.85
- urgency=0.7

---

#### T2（原因候補）

**cause_candidates例**
- KEY_BATTERY_EMPTY（電池切れ）
- RADIO_INTERFERENCE（電波干渉）
- VEHICLE_12V_LOW（車両12V低下）
- LOCK_ACTUATOR_FAULT（ドアロック故障）
- USER_OPERATION（操作条件不一致）

---

#### T3（次の1問）

**狙い**  
原因分布を一気に割る最初の質問

**Output例（質問UI）**
- Q1：「スマートキーのボタンを押すとランプは点きますか？」（Yes/No）

**expected_split**
- No → キー電池/キー故障側へ強く寄る
- Yes → 車両側/電波干渉/操作条件へ

---

#### T4（仮説評価）

- Q1=No（点灯しない）なら  
  - KEY_BATTERY_EMPTY：0.70  
  - KEY_FAULT：0.15  
  - OTHER：0.15  

- status=READY_FOR_ACTION

---

#### T5（行動選択）

**action_cards（最大3）例**
1. 今すぐ開ける：機械キーで解錠（30秒）
2. 恒久対応：電池交換（必要物：CR2032等、動画15秒＋3ステップ）
3. 不安なら：販売店/ロードサービス（位置共有・症状要約付き）

---

#### T6（結果評価）

- 「開きましたか？」Yes/No  
- Noなら：T3へ戻し「電波干渉の可能性」確認質問へ（場所/他のキー等）

---

### B) 「警告灯が点灯した」

F0検知が2パターンあります：**ユーザー申告（ランプついた）** と **車両側通知（対応車なら）**。

#### T1（事象切り出し）

**Input例**
- ユーザー：困りごと「警告灯が点灯した」
- 追加：写真アップロード（できれば最強）

**Output**
- event_id=WARNING_LAMP_ON, confidence=0.9
- さらに subtype として「ブレーキ系/エンジン系/タイヤ空気圧…」を推定

---

#### T2（原因候補）

候補は“警告灯の種類”で決まる（例）
- BRAKE_SYSTEM
- ENGINE_MALFUNCTION
- TPMS_LOW_PRESSURE
- CHARGE_SYSTEM

そして各カテゴリ内で詳細原因へ。

---

#### T3（次の1問）

警告灯は **危険度判定が最優先** なので、T3の設計が他と違います。

**質問UI（優先順）**
1. 「赤色ですか？（赤/黄/不明）」→ これで緊急度が決まる
2. 「点滅していますか？」
3. 「走行中ですか？停止中ですか？」
4. （可能なら）「写真を撮ってください」

---

#### T4（仮説評価）

- 例：赤＋点滅＋走行中 → status=ESCALATE へ寄せる（原因特定より安全）
- 例：黄＋タイヤ空気圧っぽい → status=READY_FOR_ACTION

---

#### T5（行動選択）

**赤系（高リスク）**の出力はこうなる：
- 安全確保（停止・ハザード等）
- 走行継続の可否（即時判断）
- 連絡（ロードサービス／販売店）

**黄系（中リスク）**なら：
- 「近くで確認できる行動（空気圧確認、給油口、キャップ等）」＋「様子見条件」

---

#### T6（結果評価）

「消えましたか？」だけでなく
- 「再点灯したか」
- 「走行に異常があるか」

を短問で取り、再探索 or エスカレーションへ。

---

### C) 「Bluetooth接続ができない」

これは“車両故障”よりも **状態依存・手順依存が多い** ので、T3が「分岐の設計」になります。

#### T1（事象切り出し）

**Input例**
- ユーザー：困りごと「Bluetooth接続ができない」
- 操作ログ（IVI）：Bluetooth設定画面を往復、ペアリング失敗

**Output**
- event_id=BT_NOT_CONNECTED, confidence=0.8

---

#### T2（原因候補）

- **PHONE_SIDE**  
  Bluetooth OFF、機内モード、OS権限、端末不具合
- **VEHICLE_SIDE**  
  車側BTモジュール、過去ペア情報破損
- **PAIRING_STATE**  
  登録未完了、上限超え、同名重複
- **ENVIRONMENT**  
  干渉、同時接続、距離

---

#### T3（次の1問）

最初に割るべきは **「どの段階で詰まってるか」** です。

**質問UI例**
- 「“ペアリング（機器登録）”は完了していますか？」（Yes/No/不明）
  - No → 登録フローへ
  - Yes → 接続・プロファイルへ
- （Yesの場合）「機器名は車側の一覧に表示されていますか？」
- 「別のスマホでも同じですか？」（切り分け）

---

#### T4（仮説評価）

- 例：ペアリング未完了 → PAIRING_STATE 0.8
- 例：表示されるが接続不可 → PROFILE/権限/同時接続 へ

---

#### T5（行動選択）

“成功率が高い順”に、負荷が低い手順を出す：
1. Bluetooth OFF/ON（両方）→ 再接続（1分）
2. 車側で機器削除 → 再ペアリング（3分）
3. 端末再起動 or 車側再起動（安全な範囲）

必要なら「対応機種/OS要件」も添える（ただし説明過多にしない）。

---

#### T6（結果評価）

- 「接続できましたか？」→ Noなら
  - 次のT3（別端末で試す）へ
- それでもダメなら handoff_payload を作って販売店へ（試した手順一覧が価値）
