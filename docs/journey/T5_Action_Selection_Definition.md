# T5：行動選択（Action Planning / Decision Support）

## T5の定義（採用版）

**T5の役割は、  
仮説（T4の出力）とユーザー文脈に基づき、  
「次に何をするか」を最大3つに絞り、  
手順・所要時間・必要物・危険注意・代替案を付けてユーザーに提示すること。**

---

## 1. T5の目的

T5はユーザーに選択を押し付ける工程ではありません。  
**「迷いを減らし、実行しやすい選択肢を制限して出す」** ことで、  
「肩代わり」の体感を生む **「行動の提案」** を担います。

- 即効性×安全×負荷×成功率を考慮して選択肢を最適化
- 一次解決（今すぐ）と恒久対応（きちんと直す）を分けて提示
- リスク情報（破損・感電・運転リスク等）を明示し、販売店・ロードサービスも選択肢として出す

---

## 2. T5 Input（入力）

T5は **T1〜T4の出力を可能な限り再利用** し、仮説・文脈・リスクを揃えたうえで行動選択肢を出します。以下は主な入力と、どの前フェーズから活用するかの対応です。

### 2.1 仮説（T4出力を活用）
- **T4出力**  
  - ranked_causes[] の上位（原因ID、確信度）  
  - status（READY_FOR_ACTION / ESCALATE など）  
- T5ではこれらをそのまま受け取り、行動の優先度・エスカレーション出し分けに使う。

### 2.2 ユーザー文脈（T1出力を活用）
- 欲しい内容の例：今すぐ／安全優先／屋外／深夜、急いでいるか・落ち着いて対処できるか など。
- **T1ですでに出力している**：  
  - **context_labels**（例：time_band, location_type, vehicle_state）→ 時間帯・場所・走行状態など  
  - **urgency**（緊急度 0〜1）→ 「今すぐ」かどうかの判断に利用  
  - **psychological_risk**（low / medium / high）→ 安全優先・不安度の判断に利用  
- T5では **T1のこれらの出力を優先して利用する**。不足分だけ別入力で補う。

### 2.3 ユーザープロファイル（あれば）
- DIY可否、過去の選好、初心者／慣れている など。
- 前フェーズで共通プロファイルとして持っている場合はそれを参照する。

### 2.4 リスク情報（T2・T4の出力も活用）
- 破損、感電、運転リスク、案内すべき注意（「販売店での交換を推奨」など）。
- **T2出力**の cause_candidates[] 各要素の **risk_level** を利用できる。  
- **T4出力**の status=ESCALATE のときは、安全側に寄せたリスク案内にする。

---

## 3. T5 Process（処理）

T5の処理は「選択肢の絞り込みと表現」です。T4の ranked_causes／status、T1の context_labels／urgency／psychological_risk、T2の risk_level を参照しつつ、以下を実行します。

1. 仮説の action_group とリスクに基づき、取り得る行動を列挙
2. 目的関数（即効性×安全×負荷×成功率）でスコア付けし、最大3つに絞る
3. 一次解決と恒久対応を区別して構成
4. 各行動に手順・所要時間・必要物・危険注意・代替案を付与
5. escalation_option（電話/予約/ロードサービス）を必要に応じて付与

---

## 4. T5 Output（出力）

T5はユーザーに出す「行動カード」の仕様を出力します。

### 4.1 基本出力項目

- action_cards[]（最大3）
  - action_id：行動の一意識別子
  - **guide_id**（任意）：取扱説明書由来のガイドID。例：GUIDE-001（機械キーの取り出し方）、GUIDE-005（電池交換手順）。`docs/journey/csv_data/XML_GUIDE_INTEGRATION_SUMMARY.md` のガイド一覧を参照。
  - title：短い見出し（例：「今すぐ開ける：機械キーで解錠」）
  - steps：手順（テキストまたはステップリスト）
  - duration：所要時間の目安
  - required_items：必要物（電池型番、工具など）
  - risk_notice：危険注意・推奨（「販売店での交換を推奨」など）
  - alternative：代替案（うまくいかない場合）
- escalation_option：電話/予約/ロードサービス等の案内

### 4.2 出力例

```json
{
  "action_cards": [
    {
      "action_id": "A_DOOR_001",
      "guide_id": "GUIDE-001",
      "title": "今すぐ開ける：機械キーで解錠",
      "steps": ["キーから機械キーを取り出し、ドアの鍵穴に挿して解錠"],
      "duration": "約30秒",
      "required_items": [],
      "risk_notice": null,
      "alternative": "開かない場合はロードサービスへ"
    },
    {
      "action_id": "A_DOOR_002",
      "guide_id": "GUIDE-005",
      "title": "恒久対応：電池交換",
      "steps": ["CR2032を用意", "キーを開けて電池を交換", "動作確認"],
      "duration": "約3分",
      "required_items": ["CR2032（ボタン電池）"],
      "risk_notice": "部品破損の恐れがあるため、販売店での交換を推奨します。",
      "alternative": "電池購入先の案内へ"
    },
    {
      "action_id": "A_DOOR_003",
      "guide_id": "GUIDE-006",
      "title": "不安なら：販売店・ロードサービス",
      "steps": ["位置共有・症状要約付きで連絡"],
      "duration": null,
      "required_items": [],
      "risk_notice": null,
      "alternative": null
    }
  ],
  "escalation_option": {
    "dealer": "販売店予約",
    "road_service": "ロードサービス"
  }
}
```

**UX 補足（risk_notice がある行動）**  
`risk_notice` を付与した行動（例：電池交換 A_DOOR_002）では、UX 上でその注意を表示したうえで、**「販売店で交換する」「自分で交換する」** 等をユーザーに選択させるステップを入れる。販売店を選んだ場合は予約・連絡先案内、自分でを選んだ場合は手順（steps）と必要物・注意を表示し、実施後の結果（T6）を確認する。

---

## 5. T5でやらないこと

- 原因の断定表現（「原因は〇〇です」はT4の結果をやさしく伝える程度に）
- 観察質問の選定（T3の役割）
- 結果の評価（T6の役割）
- 選択肢を3つ超えて出す（迷いを増やさない）

T5は **行動の選択肢を制限して提示する** 工程です。

---

## 6. 一文サマリ

**T5とは、  
仮説と文脈に基づき「次に何をするか」を最大3つに絞り、  
手順・リスク・代替案を付けてユーザーに提示するための行動選択である。**
