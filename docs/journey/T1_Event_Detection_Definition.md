# T1：事象切り出し（Event Detection / Labeling）

## T1の定義（採用版）

**T1の役割は、  
人が「困った」と感じているテーマをラベル化し、  
そのテーマに付随する“UX判断に必要な状態情報”を整理して渡すこと。**

---

## 1. T1の目的

T1は原因特定や正誤判断を行う工程ではありません。  
ユーザーの体験を壊さず、次の思考工程（T2以降）に進むための  
**「認知の肩代わり」** を担います。

- 正確さよりも「違和感なく出せるか」を重視
- 早く、安全に、説明可能であること
- UXの出し分け判断に必要な最小情報を渡すこと

---

## 2. T1 Input（入力）

T1が受け取るのは「証拠」ではなく「兆候」です。  
すべては意味ラベル化された状態で扱います。

### 2.1 ユーザー入力（明示的兆候）
- 困りごと選択（例：ドアが開かない）
- 自由入力テキスト
- 写真・画像（警告灯など）

### 2.2 操作ログ（非明示的兆候・主役）
- 操作失敗の繰り返し
- 同一画面の往復
- 設定・接続の失敗ログ
- 操作間隔の不自然な長さ

### 2.3 文脈データ（補助兆候）
※ 生データは必ず意味ラベル化して使用

- 時間帯（day / night など）
- 位置タイプ（home / outside / highway）
- 走行状態（stopped / moving）
- 環境要因（天候・気温など）

---

## 3. T1 Process（処理）

T1の処理は推論ではなく、分類と整理です。

1. 兆候の正規化・ラベル化（Feature化）
2. ルール＋軽い分類による事象候補生成
3. 兆候の重なりを集約
4. 事象ラベルごとの確度（confidence）算出
5. UX判断用の状態情報算出（緊急度・心理リスク等）

---

## 4. T1 Output（出力）

T1は次工程が迷わないための最小セットを出力します。

### 4.1 基本出力項目

- event_id：事象テーマID（例：DOOR_NOT_OPEN）
- **subtype（あれば）**：事象の細分類。事象によっては T2／T3 の原因候補・質問設計に使う。
  - 例（警告灯が点灯した）：警告灯の種類（ブレーキ系／エンジン系／タイヤ空気圧 等）
  - 例（ドアが開かない）：開かないドアの位置、操作手段、症状の出方 等
- confidence：事象として扱ってよい確度（0〜1）
- urgency：緊急度（0〜1）
- psychological_risk：UX配慮レベル（low / medium / high）
- context_labels：意味ラベル化された文脈情報
- evidence：判断に使った主な兆候

### 4.2 出力例

```json
{
  "event_id": "DOOR_NOT_OPEN",
  "subtype": null,
  "confidence": 0.91,
  "urgency": 0.75,
  "psychological_risk": "high",
  "context_labels": {
    "time_band": "night",
    "location_type": "outside",
    "vehicle_state": "stopped"
  },
  "evidence": [
    "user_selected_symptom",
    "unlock_fail_repeated"
  ]
}
```

---

## 5. T1でやらないこと

- 原因特定
- 正誤判定
- 長文説明
- ユーザーへの断定表現

T1は診断ではなく、**認知の肩代わり**です。

---

## 6. 自由入力時の正規化の要否（設計の考え方）

「ドアが開かない」「鍵が開かない」「キーが反応しない」など、自由文が様々な表現で入力される場合、  
**正規化・ラベル化してから event_id に紐づける**のと、**入力文言を直接 event_id に引き当てる**のと、どちらがよいか。

### 6.1 二つのアプローチ

| アプローチ | 処理の流れ | 特徴 |
|------------|------------|------|
| **A. 正規化を挟む** | 自由文 → 意図ラベル／symptom ラベル（例：door_unlock_failure）に正規化 → ラベルとルールで event_id 候補を出す | 複数入力の統合・evidence の整理・拡張がしやすい |
| **B. 直接引き当て** | 自由文 → キーワード／意図マッチで直接 event_id 候補を出す（keyword_to_event 等） | 実装がシンプルで、事象が少ないうちは十分 |

**どちらでも event_id は出せます。** 「直接引き当て」でも、キーワード／意図マッチ表（例：keyword_to_event）に「鍵が開かない」「キーが反応しない」を DOOR_NOT_OPEN に紐づけておけば、正規化ステップなしで事象候補は得られます。

### 6.2 正規化・ラベル化を挟むメリット（A を推奨する理由）

1. **evidence の一貫性**  
   「どの表現で来たか」をいったん **意図ラベル**（例：door_unlock_failure）にまとめると、evidence を「free_text_match(door_unlock_failure)」のように統一できます。直接引き当てだと「鍵が開かない」「キーが反応しない」など表現ごとに evidence がばらけ、ログ・分析で扱いづらくなります。

2. **複数入力の統合**  
   自由文「鍵が効かない」＋ 操作ログ（解錠失敗2回）を、どちらも **同じ features**（symptom=door_unlock_failure, unlock_fail_count=2）に載せられ、confidence 算出や「支持した兆候」の根拠を一括で扱えます。直接 event_id だけにすると、自由文とログを同じ土俵で重みづけしにくいです。

3. **subtype の切り出し**  
   「フロント左だけ開かない」「リモコンは効くがハンドルだと開かない」など、表現から **細かい情報**を切り出したい場合、正規化の段階で「開かないドアの位置」「操作手段」などのラベルにしておくと、T2／T3 の原因候補・質問の出し分けにそのまま使えます。直接 event_id に飛ぶと、この情報を後から取りに戻す必要があります。

4. **言い換えの追加が容易**  
   新しい言い方（例：「リモコン効かない」）が増えたとき、**「どの意図ラベルに正規化するか」を1箇所で管理**し、意図ラベル → event_id は 1 対 1 のままにできます。直接引き当てだと、keyword_to_event に同じ event_id のエントリが増えていくだけですが、意図ラベルを挟むと「解錠不良系」というまとまりでルールや分析を書けます。

### 6.3 推奨方針

- **事象数が少なく、自由文のみ or 自由文＋選択程度**で、subtype や複数兆候の統合をあまり使わないなら、**B. 直接引き当て**で十分です。プロセス1の「自由文の正規化」は「キーワード／意図マッチの結果を event_id 候補に渡す」程度に縮小してよいです。
- **操作ログと自由文を一緒に扱う・evidence を揃えたい・subtype を出したい・言い換えをまとめて管理したい**なら、**A. 正規化を挟む**を推奨します。  
  具体的には、自由文をいったん **意図ID／symptom ラベル**（例：door_unlock_failure）に正規化し、そのラベルと「解錠失敗」などの操作ログ特徴を同じ features に載せて、プロセス2で event_id 候補を出す形にします。

### 6.4 実装の目安

- **正規化を挟む場合**  
  自由文 → キーワード／意図マッチで **意図ラベル**（door_unlock_failure 等）を出し、features に `symptom=意図ラベル` を追加。意図ラベルと event_id の対応は 1 対 1 でよい（例：door_unlock_failure → DOOR_NOT_OPEN）。evidence には `free_text_match` を列挙。
- **直接引き当ての場合**  
  自由文 → keyword_to_event（または意図マッチ）で **event_id 候補**を直接取得。プロセス1の「自由文の正規化」は「マッチした event_id を features に載せる」程度にし、evidence には `free_text_match` を入れる。操作ログと自由文の両方があるときは、confidence 算出で「自由文マッチ ＋ ログマッチ」の両方を考慮するルールを別途持つ。

---

## 7. 一文サマリ

**T1とは、  
人の「困った」をAIが構造化し、  
UX判断に必要な状態情報とともに次工程へ渡すための入口である。**
