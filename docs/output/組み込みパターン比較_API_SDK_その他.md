# 取扱説明書DX システム：組み込みパターン比較（API / SDK / その他）

**作成日**: 2026年2月3日  
**前提**: 統合_システム要件定義書に基づく「OEM・コールセンター・車載など複数チャネルへの組み込み」を検討するための整理

---

## 1. 結論サマリ

| 質問 | 推奨 |
|:--|:--|
| **API連携サービスにすべき？** | **はい。コア提供形態はAPI（REST/GraphQL）を第一とする** |
| **SDKにすべき？** | **補助的に用意する。必須ではないが、導入障壁低下・ブランド統一に有効** |
| **他に良い方法は？** | **Widget/埋め込み、オンプレ・プライベートクラウド、ホワイトラベルを用途に応じて選択** |
| **いろいろなパターンを準備すべき？** | **Phase 1は「API + 公式クライアント（軽量SDK）」に集中し、Phase 2以降でWidget・オンプレ・車載専用SDKを追加** |

**理由（要約）**  
- クライアントが **スマホアプリ / Web / 車載 / コールセンター** と多様なため、**APIを軸**にするとあらゆるスタックで利用可能。  
- OEMごとのUI・ブランド要件が強いため、**SDKは「薄いラッパー＋サンプル」**程度にし、UIはOEM側に任せる方が柔軟。  
- 車載・オンプレなど**ネットワーク・規制の制約**がある顧客向けに、後から別パターン（オンプレ、専用SDK）を用意する設計が現実的。

---

## 2. 組み込みパターン一覧と位置づけ

```
                    【提供側：取扱説明書DX システム】
                                    │
    ┌───────────────────────────────┼───────────────────────────────┐
    │                               │                               │
    ▼                               ▼                               ▼
【API中心】                   【SDK/クライアント】              【その他】
・REST / GraphQL API          ・公式SDK（薄いラッパー）         ・Widget / iframe
・WebSocket（ストリーミング）  ・Platform別SDK（車載等）         ・オンプレ / プライベート
・Webhook                      ・管理用CLI/ツール                ・ホワイトラベルSaaS
```

---

## 3. 各パターンの詳細（メリット・デメリット・制約）

### 3.1 REST / GraphQL API（API連携サービス）

| 項目 | 内容 |
|:--|:--|
| **概要** | バックエンドのRAG・プロアクティブ・管理機能をHTTP APIで公開。クライアントは自前実装で呼び出す。 |
| **想定利用者** | スマホアプリ（Flutter等）、Webチャット（Next.js等）、OEM管理画面、コールセンター、将来の車載クライアント |

**メリット**

| メリット | 説明 |
|:--|:--|
| **スタック非依存** | 任意の言語・フレームワーク（Flutter, Swift, Kotlin, React, 車載Qt/C++など）から利用可能。 |
| **単一実装で全チャネル対応** | 同じAPIをアプリ・Web・コールセンター・車載で共有でき、開発・保守が一本化できる。 |
| **バージョン・進化の管理が容易** | エンドポイント・スキーマのバージョニング（例: `/v1/`, `/v2/`）で互換性を制御しやすい。 |
| **既存要件との整合** | 統合要件定義書の「RESTful API・GraphQL」「API仕様書整備」と一致する。 |
| **スケール・運用の責任が自社に集約** | 認証・レート制限・監視・デプロイを一元的に管理できる。 |

**デメリット**

| デメリット | 説明 |
|:--|:--|
| **呼び出し側の実装負荷** | 各OEM・チャネルでHTTPクライアント、エラーハンドリング、リトライ、認証を自前実装する必要がある。 |
| **ネットワーク必須** | オフライン・車載の閉域網など、常時接続が難しい環境ではそのままでは使えない。 |
| **レイテンシ** | 往復1往復以上の遅延が必ず発生。1秒以下目標であればキャッシュ・設計の工夫が必要。 |

**制約**

| 制約 | 内容 |
|:--|:--|
| **可用性** | クライアントは「APIが落ちたとき」のフォールバック（キャッシュ表示・簡易メッセージ）を自前で用意する必要がある。 |
| **認証・キー管理** | APIキーやOAuthの管理をOEMに依頼する必要があり、オンボーディングの手順・ドキュメントが重要。 |
| **レート制限・コスト** | 従量課金やレート制限を設ける場合、契約・ドキュメントで明示する必要がある。 |

**本システムでの位置づけ**  
→ **中核とする。Phase 1からREST/GraphQL APIを正式提供し、全チャネルは原則このAPIを利用する。**

---

#### 3.1.1 API連携に限定した場合に「対応できない／難しい」顧客

**前提**: 提供形態を「API連携のみ」に限定した場合、以下のような顧客はそのままでは対応できないか、対応が難しくなる。

| 顧客の状況・要件 | なぜAPIのみでは難しいか | 必要な代替提供形態 |
|:--|:--|:--|
| **自前インターフェースを持っていない** | APIは「呼び出す側」のアプリ・画面が必要。UIを自前で開発するリソース（人・期間・予算）がないと、サービスをエンドユーザーに届けられない。 | **ホワイトラベルアプリ／ホスト型UI**（提供側が画面まで用意し、OEMはドメイン・ロゴ等のみ設定）、または **Widget/埋め込み**（既存サイトに貼るだけ）。 |
| **開発チームがいない／API連携ができない** | 認証・HTTPクライアント・エラーハンドリング・リトライを実装する「受け手」がいない。営業・事業部門だけではAPIを利用できない。 | **ホスト型のチャット画面・検索画面**（URLを共有するだけ）、**Widget**（スクリプト1行で埋め込み）、または **SI/パートナー経由**で受け手側の実装を代行。 |
| **「すぐ使える」だけ欲しい（ゼロ開発）** | 「リンクを配る」「既存ページに1行足す」で使いたい。APIだけ渡されても、自社で画面を作る前提は受け入れられない。 | **ホスト型UI**（例: `https://manual-dx.example.com/chat?brand=OEM名`）、**Widget/iframe**。 |
| **データを社外に送れない（規制・ポリシー）** | SaaSのAPI = 問い合わせ・ログが提供側のクラウドに流れる。データ持ち出し禁止・データローカライゼーション要件がある顧客は利用できない。 | **オンプレミス／プライベートクラウド**（APIは同一だが、インスタンスが顧客環境内に存在する形態）。 |
| **常時ネットワークが使えない環境** | 車載の閉域網・トンネル内・オフライン工場など、HTTPで外部APIを叩けない。APIは「その場では」使えない。 | **オンプレ／車内サーバ**、**オフライン対応SDK**（キャッシュ＋同期）、または **事前配信コンテンツ＋ローカル検索** など、ネットワークに依存しない形態。 |
| **既存システムがHTTP APIを呼べない** | レガシーコールセンター、専用端末、メインフレーム連携など「RESTを叩く」機能がない。 | **ファイル連携（バッチ）**、**メッセージキュー（MQ）**、**オンプレのゲートウェイ**が社内システムと話し、その先で当方APIと連携する構成。 |
| **UI/UXを一切触りたくない（完成品のみ）** | 「自社ブランドのアプリとして完成品が欲しい」が、中身の開発はしたくない。API＋仕様書だけでは「完成品」にならない。 | **ホワイトラベルSaaS**（ドメイン・ロゴ・色のみ変更した完成アプリ）、または **OEM向けパッケージアプリ**（設定のみで利用可能）。 |

**まとめ（APIのみで足りないケース）**

- **自前インターフェースがない** → ホスト型UI / Widget / ホワイトラベル  
- **APIを呼ぶ開発リソースがない** → ホスト型UI / Widget / パートナー実装  
- **データを外に出せない** → オンプレ／プライベート  
- **ネットが使えない／閉域のみ** → オンプレ／オフライン対応SDK／ローカル配信  
- **既存システムがRESTを話さない** → ゲートウェイ／ファイル／MQ などの中間形態  

API連携を**主軸**にしつつ、上記のような顧客を取りこぼさないためには、**Phase 2以降で「ホスト型UI」「Widget」「オンプレオプション」**を用意しておく設計が現実的。

---

### 3.2 SDK（公式クライアント・Platform別SDK）

| 項目 | 内容 |
|:--|:--|
| **概要** | APIをラップしたライブラリを提供。言語/プラットフォーム別（例: JavaScript/TypeScript、Flutter、Swift/Kotlin、車載C++等）に配布。 |
| **想定利用者** | OEMのアプリ開発者、社内のWeb/アプリ開発者。車載はPhase 2以降で専用SDKを検討。 |

**メリット**

| メリット | 説明 |
|:--|:--|
| **導入の手間削減** | 認証・リトライ・シリアライズをSDKに集約でき、OEMの実装工数とバグを減らせる。 |
| **ベストプラクティスの埋め込み** | キャッシュ方針・タイムアウト・ストリーミングの扱いをSDK側で統一しやすい。 |
| **型・ドキュメントとの一体** | TypeScript等では型定義と一緒に配布することで、IDE補完と仕様の一致が期待できる。 |
| **ブランド・UXのガイド** | UIコンポーネント付きSDKにすると、OEMが「推奨UI」をそのまま使え、体験の一貫性を図れる。 |

**デメリット**

| デメリット | 説明 |
|:--|:--|
| **維持コスト** | 言語・プラットフォームごとにビルド・テスト・バージョン管理が必要。複数SDKを厚くすると負荷が大きい。 |
| **バージョンずれ** | クライアントが古いSDKのまま使い続けると、APIの新機能やセキュリティ修正が届かない。 |
| **過剰な抽象化** | 厚いSDKにしすぎると、OEMが「APIの細かい制御」をしたくてもできず、かえって不満になる場合がある。 |
| **配布経路** | 車載はOEM専用ビルド・証明書等が必要になり、npm/Pub.devだけでは足りない場合がある。 |

**制約**

| 制約 | 内容 |
|:--|:--|
| **サポート範囲** | 公式にサポートする言語・バージョンを決め、それ以外は「コミュニティ・自前」と明示する必要がある。 |
| **ライセンス** | オープンソースにするかプロプライエタリにするかで、OEMの法務・採用条件が変わる。 |
| **サイズ** | モバイル・車載ではアプリサイズが敏感なため、SDKは軽量（APIラッパー中心）に抑える方が安全。 |

**本システムでの位置づけ**  
→ **補助的に用意する。Phase 1では「API + 軽量公式クライアント（TypeScript/JavaScript、必要ならFlutter）」に留め、UIはOEM任せ。Phase 2以降で車載向けC++/Qt等のSDKを検討。**

---

### 3.3 Widget / iframe 埋め込み

| 項目 | 内容 |
|:--|:--|
| **概要** | 検索・チャット・プロアクティブ案内を、1つのJavaScriptタグまたはiframeで他サイト・OEMポータルに埋め込む。 |
| **想定利用者** | OEMの既存Webサイト、ポータル、コールセンターの既存画面。 |

**メリット**

| メリット | 説明 |
|:--|:--|
| **組み込みが極めて簡単** | 数行のスクリプトまたはiframeで、OEMが自前でフルUIを開発せずに機能を提供できる。 |
| **UI・アップデートの一元管理** | 見た目や挙動を提供側で更新すれば、埋め込み先は自動で最新になる。 |
| **ドメイン・認証の整理** | 同一オリジンまたはiframeで、APIキー・セッションをWidget側に集約できる。 |

**デメリット**

| デメリット | 説明 |
|:--|:--|
| **カスタマイズの限界** | 色・文言・レイアウトをOEMのブランドに完全に合わせるには、テーマAPIやホワイトラベル版が必要。 |
| **パフォーマンス・制約** | サードパーティスクリプトとして読み込むため、親ページの表示やCore Web Vitalsに影響し得る。 |
| **iframeの制約** | クロスオリジンではCookie・ストレージの制限があり、認証連携の設計がやや複雑になる。 |
| **車載・ネイティブでは使えない** | 車載HMIやネイティブアプリではそのまま使えず、API/SDKが依然として主役。 |

**制約**

| 制約 | 内容 |
|:--|:--|
| **CSP・セキュリティポリシー** | OEMのCSPで`script-src`や`frame-src`に自ドメインを許可してもらう必要がある。 |
| **アクセシビリティ** | 埋め込み部分もWCAG等を満たす責任が提供側にあり、テストが必要。 |

**本システムでの位置づけ**  
→ **Phase 2以降のオプション。コールセンターの既存画面やOEMポータルへの「そのまま貼る」用途で価値が大きい。Phase 1では必須にしない。**

---

### 3.4 オンプレミス / プライベートクラウド

| 項目 | 内容 |
|:--|:--|
| **概要** | RAG・プロアクティブ・管理機能を、OEMのデータセンターまたは指定クラウド（VPC）に専用インスタンスとして導入する。 |
| **想定利用者** | データ持ち出し禁止が厳しいOEM、車載で「車内完結」を求めるケース。 |

**メリット**

| メリット | 説明 |
|:--|:--|
| **データローカライゼーション** | 取説データ・ログを自社外に出さずに済み、規制・セキュリティ要件を満たしやすい。 |
| **ネットワーク制約への対応** | 車載の閉域網や工場内ネットから、パブリックAPIに出さずにアクセスできる。 |
| **SLA・カスタマイズ** | 専用契約でSLA・スペック・パッチ適用時期を個別に取り決めやすい。 |

**デメリット**

| デメリット | 説明 |
|:--|:--|
| **導入・運用コストが大きい** | インストール、初期設定、アップデート、監視を提供側・OEM側の両方で負担する。 |
| **バージョン分散** | 各OEMで異なるバージョンが稼働しやすく、バグ修正・新機能の展開が遅れがち。 |
| **マルチテナントの効率が得られない** |  SaaSのようにリソースを共有できないため、単価は高くなりがち。 |

**制約**

| 制約 | 内容 |
|:--|:--|
| **契約・運用モデル** | ライセンス、保守、アップデート頻度、サポート範囲を契約で明確にする必要がある。 |
| **リソース要件** | GPU/CPU/メモリ/ストレージの要件を文書化し、OEMが準備できるかを見る必要がある。 |

**本システムでの位置づけ**  
→ **Phase 2以降で「一部OEM向けオプション」として検討。Phase 1ではパブリックAPI（SaaS）を前提とする。**

---

### 3.5 ホワイトラベルSaaS

| 項目 | 内容 |
|:--|:--|
| **概要** | 同一のサービス基盤の上で、OEMごとにドメイン・ロゴ・色・名称を変更して提供する。アプリ・Webを「OEM名義」で提供。 |
| **想定利用者** | 自社ブランドで提供したいが、自前開発はしたくないOEM。 |

**メリット**

| メリット | 説明 |
|:--|:--|
| **OEMのブランド要件に対応** | 見た目・ドメインをOEM名にできるため、顧客向け説明がしやすい。 |
| **提供側はマルチテナントのまま** | インフラは共通のため、オンプレより運用効率が良い。 |
| **収益モデル** | テナント単位の課金（月額・従量）と相性が良い。 |

**デメリット**

| デメリット | 説明 |
|:--|:--|
| **テナント分離の設計** | 認証・データ・設定をテナント単位で分離する設計が必須。Phase 1から入れると初期設計が重い。 |
| **カスタマイズ要望の増加** | 「自社だけ特別に」が増えると、設定項目やコード分岐が膨らみやすい。 |

**制約**

| 制約 | 内容 |
|:--|:--|
| **データ・契約** | どのデータがどのOEMに属するか、契約・プライバシーポリシーで明確にする必要がある。 |

**本システムでの位置づけ**  
→ **中長期で検討。Phase 1では「単一テナントまたは限定的マルチテナント」で開始し、需要に応じてホワイトラベルを拡張する形が現実的。**

---

### 3.6 Webhook（サーバー→クライアント通知）

| 項目 | 内容 |
|:--|:--|
| **概要** | プロアクティブ案内の配信・イベント発生時に、提供側からOEMの指定URLへHTTPで通知する。 |
| **想定利用者** | コールセンターシステム、OEMのバックエンド。アプリは主にプッシュ通知経由で受け取る想定。 |

**メリット**

| メリット | 説明 |
|:--|:--|
| **プッシュ型の連携** | クライアントがポーリングしなくてよく、リアルタイム性を出しやすい。 |
| **既存システムとの接続** | コールセンターのCRM等が「URLを受け取って処理」するパターンと相性が良い。 |

**デメリット**

| デメリット | 説明 |
|:--|:--|
| **OEM側でエンドポイントの用意が必要** | URLの公開、TLS、認証（署名検証等）をOEMが用意する必要がある。 |
| **再送・冪等性** | 障害時の再送と、重複処理を防ぐ設計が双方に必要。 |

**制約**

| 制約 | 内容 |
|:--|:--|
| **ファイアウォール** | OEM側が着信を許可する必要があり、社内ポリシーによっては難しい場合がある。 |

**本システムでの位置づけ**  
→ **APIの「補助」として、プロアクティブ配信・イベント通知用に仕様に含めておく。Phase 1では必須でなく、Phase 2で本格利用を想定。**

---

## 4. パターン別 比較マトリクス

| 観点 | REST/GraphQL API | SDK | Widget/iframe | オンプレ | ホワイトラベル | Webhook |
|:--|:--|:--|:--|:--|:--|:--|
| **実装負荷（提供側）** | 中 | 高（複数言語で顕著） | 中 | 高 | 高 | 低〜中 |
| **実装負荷（利用側）** | 中〜高 | 低 | 極めて低 | 中（導入手順） | 低 | 中（エンドポイント用意） |
| **スタック自由度** | ◎ | △（サポート言語に依存） | △（Web中心） | ◎ | ◎ | ◎ |
| **オフライン/閉域網** | × | △（キャッシュ等は可能） | × | ◎ | × | △ |
| **データ外だし制約** | △（SaaS前提） | 同左 | 同左 | ◎ | △ | △ |
| **ブランド/UIの自由度** | ◎ | ◎（薄いSDKの場合） | △ | ◎ | ○ | − |
| **Phase 1で現実的か** | ◎ | ○（軽量に限る） | △ | × | △ | ○（任意） |

---

## 5. 推奨ロードマップ

| Phase | 提供する組み込みパターン | 備考 |
|:--|:--|:--|
| **Phase 1** | ・**REST/GraphQL API**（コア）<br>・**軽量公式クライアント**（TypeScript/JS、必要ならFlutter）<br>・API仕様書・Postman/OpenAPI | 全チャネルはAPI経由。SDKは「ラッパー＋サンプル」程度。 |
| **Phase 2** | ・上記に加え<br>・**Widget/iframe**（Web・コールセンター向け）<br>・**Webhook**（プロアクティブ・イベント）<br>・**車載向けSDK/APIプロファイル**の検討 | オンプレは「要望の強いOEM」に限定検討。 |
| **Phase 3以降** | ・**オンプレ/プライベート**オプション<br>・**ホワイトラベル**の本格化<br>・車載専用SDK・プロトコル最適化 | 規制・ニーズに応じて選択肢を追加。 |

---

## 6. 「いろいろなパターンを準備すべきか」への回答

- **Phase 1では「API + 軽量SDK（1〜2言語）」に集中することを推奨する。**  
  理由：リソースを分散させず、品質の高いAPIとドキュメントを優先した方が、OEMの信頼と後の拡張に有利。
- **複数パターン（Widget、オンプレ、ホワイトラベル）は、需要とPhaseが明確になってから追加する**と、設計の二度やりや過剰な抽象化を避けられる。
- **API設計は「将来のオンプレ・Webhook・別プロトコル」を意識する**とよい。  
  例：認証をトークンベースに統一、イベント種別を共通スキーマで定義、など。

---

## 7. 参照

- 統合_システム要件定義書（`docs/output/統合_システム要件定義書.md`）  
  - 1.2 システムの位置づけ、FR-3 マルチチャネル展開、NFR-5 API設計、技術スタック
- モック完成のための要件定義書（`docs/output/モック完成のための要件定義書.md`）  
  - API連携要件（検索・チャット・プロアクティブ・統計）
