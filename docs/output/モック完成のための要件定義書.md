# モック完成のための要件定義書

**作成日**: 2026年1月28日  
**プロジェクト名**: 取扱説明書DX システム  
**バージョン**: 1.0  
**対象**: 開発部門、UI/UX担当、バックエンド担当  
**前提**: 本ドキュメントは `docs/output/統合_システム要件定義書.md` を補完し、**既存モックを本番相当に完成させるために必要な要件**を定義する。

---

## 📋 エグゼクティブサマリー

### 目的

以下の3つのモックを、本番運用可能なレベルまで完成させるために**漏れている要件**を明文化する。

| チャネル | モックファイル | 役割 |
|:--|:--|:--|
| **エンドユーザー向け** | `public/index.html` | 車両オーナー向けアプリ（検索・チャット・プロアクティブ案内・設定） |
| **コールセンター向け** | `public/call-center.html` | サポートスタッフ向けチャット（車種・年式指定、RAG回答） |
| **管理画面** | `docs/mockups/oem-dashboard.html` | OEM向けダッシュボード（統計・問合せ分析・コンテンツ管理・ユーザー管理・設定） |

### 統合要件定義書との関係

- **統合_システム要件定義書.md**: 事業目的、RAG/プロアクティブの技術要件、Phase別ロードマップ、非機能要件を定義。
- **本ドキュメント**: 上記3モックの**画面・フロー・データ・API・連動**に特化した「完成のための要件」を定義。統合版に**画面単位の詳細が不足している部分**を補う。

---

## 1. 対象モックの一覧と参照

### 1.1 エンドユーザー向けアプリ（`public/index.html`）

**主な画面・要素:**

| 画面/要素 | 説明 | 現状（モック） |
|:--|:--|:--|
| ログイン画面 | ユーザー識別（モックでは簡易） | 入力なしで「ログイン」で次へ |
| 車種選択画面 | Model G / Model B 選択、車両画像表示 | 選択のみ、永続化なし |
| ホーム | 今すぐ確認、車両画像、検索、おすすめ機能、よくある質問 | 検索・チャットはローカルモック |
| タブ: ホーム / チャット / 通知 / ステータス | タブ切替 | チャットはモックエンジン、通知・ステータスは未実装 |
| 検索 | キーワード検索 → 回答表示 | `performSearch()` はローカルモック |
| チャット | メッセージ送信・受信、クイックリプライ、ステップガイド（ドアが開かない等） | `chat-engine-cc.js` と別のモックエンジン、RAG API 未接続 |
| 今すぐ確認 | プロアクティブ案内のランダム表示 | `displayRandomAlert()` で固定メッセージ群から表示 |
| おすすめ機能 | 未使用機能の提案、動画リンク、フィードバック | 静的表示・モック |
| 設定画面 | 言語、通知、表示、アカウント | UI のみ、保存未実装 |

**データ連動（現状）:**  
検索・チャット送信・「今すぐ確認」閲覧時に `localStorage`（`doi_oem_dashboard_stats`）へ統計を記録。OEMダッシュボードと同一オリジン（例: ローカルサーバー）で開いた場合に連動。

---

### 1.2 コールセンター向けアプリ（`public/call-center.html`）

**主な画面・要素:**

| 画面/要素 | 説明 | 現状（モック） |
|:--|:--|:--|
| ヘッダー | 「コールセンター - チャットサポート」 | 固定 |
| サイドバー | 対象モデル（Model G / B）、年式（発売時期） | 選択のみ、API に渡す想定 |
| チャット領域 | メッセージ一覧、入力欄、送信 | `chat-engine-cc.js` でモック応答（T1–T6 診断フロー等） |
| ステップガイド | ドアが開かない等の診断でモーダル表示 | 同一 JS 内で完結 |

**データ連動（現状）:**  
チャット送信時に `recordOemQuestion(messageText, 'staff')` で `doi_oem_dashboard_stats` を更新。OEMダッシュボードと連動。

---

### 1.3 管理画面（`docs/mockups/oem-dashboard.html`）

**主な画面・メニュー:**

| 画面 | 説明 | 現状（モック） |
|:--|:--|:--|
| 5. ダッシュボード | 利用状況、総質問数、回答精度、TOP5、プロアクティブ効果、レポートDL | 表示: localStorage + フィルタ（全て/エンドユーザー/サポート）、レポートDLは未実装 |
| 5-2. 利用統計 | 期間・車種フィルタ、機能別利用・満足度、年代別・車種別、CSVエクスポート | 静的テーブル、API 未接続 |
| 5-3. 問合せ分析 | 緊急度別割合、機能別問合せ・解決チャネル、チャット/電話内訳、推奨アクション | 静的、API 未接続 |
| 5-4. コンテンツ管理 | モデル・年式別 XML/HTML/PDF 一覧、取り込み・削除、新規モデル追加 | クライアント側のみ、バックエンド未接続 |
| 5-5. ユーザー管理 | ユーザー一覧、検索、新規追加・編集・無効化 | 静的一覧、CRUD 未実装 |
| 5-6. 設定 | 言語、通知、表示、アカウント・セキュリティ、データエクスポート | UI のみ、保存未実装 |

**データ連動（現状）:**  
`doi_oem_dashboard_stats` を読み取り、Storage イベント・BroadcastChannel・3秒ポーリングで更新。file:// では注意表示、同一オリジン（例: localhost）でエンドユーザー/コールセンターと連動。

---

## 2. エンドユーザー向けアプリ完成要件（`public/index.html`）

### 2.1 認証・セッション

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| EU-A1 | ログイン機能（メール/パスワードまたはOAuth）を実装し、セッションを維持する | 高 | 統合要件定義書の認証・認可に準拠 |
| EU-A2 | 未ログイン時はログイン画面へリダイレクトし、ログイン後に車種選択またはホームへ遷移する | 高 | 現状はモックでスキップ可能 |
| EU-A3 | ログアウト時にセッション破棄とログイン画面表示を行う | 中 | |

### 2.2 車種・車両

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| EU-V1 | 選択した車種（例: Model G / B）をユーザーアカウントまたは端末に紐づけて永続化する | 高 | 現状はメモリのみ |
| EU-V2 | 車種・年式（または発売時期）を検索・チャット・プロアクティブのAPIに渡し、車種別コンテンツで回答する | 高 | RAGのコンテキストとして必須 |
| EU-V3 | 車両画像は車種に応じて表示する（現状の画像URLを維持しつつ、将来はAPIで取得可能にすること） | 中 | |

### 2.3 検索

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| EU-S1 | 検索キーワードをRAG検索APIに送信し、回答を表示する | 最高 | 統合要件定義書 FR-1（RAGベース検索型AI）に対応 |
| EU-S2 | 検索時に車種・年式（またはユーザーコンテキスト）をAPIに含める | 高 | |
| EU-S3 | 検索結果は回答精度・利用統計に計上し、OEMダッシュボードと連動する（バックエンド経由で集計することを推奨） | 高 | 現状は localStorage のみ |
| EU-S4 | エラー時・回答不能時に適切なメッセージとエスカレーション案内を表示する | 高 | 統合 FR-1.6 回答品質管理 |

### 2.4 チャット

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| EU-C1 | チャットメッセージをRAG/対話APIに送信し、回答を表示する（ストリーミング対応を推奨） | 最高 | 統合 FR-1、FR-3.3 |
| EU-C2 | 会話履歴をAPIまたはセッションで保持し、文脈を考慮した回答を実現する | 高 | |
| EU-C3 | クイックリプライ・ステップガイド（例: ドアが開かない診断）は、APIの応答構造に合わせて表示する | 高 | 現状は chat-engine モックで固定 |
| EU-C4 | チャット送信を利用統計に計上し、OEMダッシュボードと連動する（バックエンド経由を推奨） | 高 | |

### 2.5 プロアクティブ案内

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| EU-P1 | 「今すぐ確認」はプロアクティブ案内APIから取得し、ユーザー・車種・文脈に応じた案内を表示する | 高 | 統合 FR-2（プロアクティブ情報提供） |
| EU-P2 | 案内の閲覧・タップを記録し、案内配信数・閲覧率をOEMダッシュボードで集計できるようにする | 高 | 現状は proactiveViewed のみ localStorage |
| EU-P3 | 「おすすめ機能」は未使用機能提案APIまたはログベース案内APIと連携する（Phase 2以降でも可） | 中 | 統合 FR-2.2 |

### 2.6 通知・ステータス・設定

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| EU-N1 | 通知タブで、プロアクティブ案内・システム通知の一覧を表示する（API連携） | 中 | 現状は未実装 |
| EU-N2 | ステータスタブで、車両状態や利用状況のサマリを表示する（Phase 2で車両データ連携時により具体化） | 低 | |
| EU-SET1 | 設定画面の言語・通知・表示・アカウントを保存し、再表示時に反映する（APIまたはローカル設定） | 中 | 統合 FR-6 多様化対応 |

### 2.7 非機能（エンドユーザー）

| ID | 要件 | 優先度 |
|:--|:--|:--|
| EU-NFR1 | 検索・チャットのレスポンスは1秒以内を目標とする（統合 NFR-1 に準拠） | 高 |
| EU-NFR2 | オフライン時またはAPI障害時に、キャッシュや簡易メッセージでUXを維持する | 中 |

---

## 3. コールセンター向けアプリ完成要件（`public/call-center.html`）

### 3.1 認証・権限

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| CC-A1 | コールセンター担当者向けのログインを実装し、未認証時はログイン画面へ遷移する | 高 | 統合 FR-3.3 |
| CC-A2 | ロールに応じたアクセス制御（閲覧のみ／操作可など）を検討する | 中 | 管理画面のロールと整合 |

### 3.2 対象車両

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| CC-V1 | サイドバーで選択した「モデル」「年式（発売時期）」をすべてのRAG/チャットAPIリクエストに含める | 最高 | 現状は DOM のみ、API 未接続 |
| CC-V2 | 選択中の車種・年式をUIに明示し、必要に応じてセッションに保持する | 高 | |

### 3.3 チャット・RAG

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| CC-C1 | チャット入力をRAG/対話APIに送信し、回答を表示する（エンドユーザーと同一または専用API） | 最高 | 統合 FR-3.3 Web版Chatbot |
| CC-C2 | ステップガイド（ドアが開かない等の診断フロー）はAPIの応答に基づいて表示する | 高 | 現状は chat-engine-cc.js でモック |
| CC-C3 | 送信メッセージを「サポートスタッフ」発として統計に計上し、OEMダッシュボードの「サポートスタッフ」フィルタで集計できるようにする | 高 | 現状は localStorage |

### 3.4 非機能（コールセンター）

| ID | 要件 | 優先度 |
|:--|:--|:--|
| CC-NFR1 | レスポンス時間1秒以内を目標とする | 高 |
| CC-NFR2 | 同時に複数セッション（複数お客様対応）を考慮した設計とする（将来拡張） | 低 |

---

## 4. 管理画面完成要件（`docs/mockups/oem-dashboard.html`）

### 4.1 認証・共通

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-A1 | 管理画面用ログインを実装し、未認証時はログイン画面へリダイレクトする | 高 | 統合 FR-3.4 |
| OEM-A2 | ヘッダーの「ログアウト」でセッション破棄とログイン画面表示を行う | 高 | |
| OEM-A3 | 組織名（例: トヨタ自動車株式会社）はログインユーザーのテナントに応じて表示する | 中 | マルチテナント時 |

### 4.2 ダッシュボード（5.）

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-D1 | 月間アクティブユーザー数・総質問数・回答精度をバックエンドAPIから取得し表示する | 高 | 現状は localStorage + デフォルト値 |
| OEM-D2 | 「よく検索される機能 TOP 5」をAPIから取得し、期間・車種フィルタに対応する | 高 | |
| OEM-D3 | プロアクティブ案内の配信数・閲覧率・機能利用率向上をAPIから取得する | 高 | |
| OEM-D4 | 表示フィルタ「全て / エンドユーザー / サポートスタッフ」をAPIのクエリに反映する | 高 | 現状はクライアント側フィルタのみ |
| OEM-D5 | 「レポートをダウンロード」でPDF/CSVを生成・ダウンロードする（APIまたはサーバー側生成） | 中 | |

### 4.3 利用統計（5-2.）

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-S1 | 期間・車種のフィルタをAPIに渡し、機能別利用状況・満足度テーブルを取得して表示する | 高 | 現状は静的 |
| OEM-S2 | 年代別・車種別利用状況をAPIから取得する | 中 | |
| OEM-S3 | CSVエクスポートを実装する（APIまたはクライアント生成） | 中 | |

### 4.4 問合せ分析（5-3.）

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-I1 | 緊急度別割合・機能別問合せ件数・解決チャネル・チャット/電話内訳をAPIから取得する | 高 | 現状は静的 |
| OEM-I2 | 問合せ分析用の「表示: 全て/エンドユーザー/サポートスタッフ」をダッシュボードと同期し、APIに反映する | 中 | |
| OEM-I3 | 推奨アクション・レポートDL・カスタマーサポート共有はAPIまたはワークフローと連携する | 低 | |

### 4.5 コンテンツ管理（5-4.）

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-C1 | モデル・年式別の格納データ一覧をAPIから取得し表示する | 高 | 現状はHTML静的 |
| OEM-C2 | XML/HTML/PDFのアップロード（取り込み）をAPIに送信し、一覧を更新する | 高 | 統合 FR-1.1 データクリーニング・構造化の入口 |
| OEM-C3 | 格納データの削除をAPIで実行し、一覧を更新する | 高 | |
| OEM-C4 | 新規モデル（新規格納）の追加をAPIで実行する | 中 | |
| OEM-C5 | 検索窓でファイル名・モデル名・年式によるフィルタを行う（クライアントまたはAPI） | 中 | 現状はクライアント側 |

### 4.6 ユーザー管理（5-5.）

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-U1 | ユーザー一覧をAPIから取得し表示する（ページネーション・検索対応） | 高 | 現状は静的テーブル |
| OEM-U2 | 新規ユーザー追加をAPIで実行する（メール・ロール・初期パスワード等） | 高 | |
| OEM-U3 | ユーザーの編集（名前・メール・ロール等）をAPIで実行する | 高 | |
| OEM-U4 | ユーザーの無効化・有効化をAPIで実行する | 高 | |
| OEM-U5 | 検索窓で名前・メール・ロールによるフィルタを行う | 中 | 現状はクライアント側 |

### 4.7 設定（5-6.）

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| OEM-X1 | 言語設定をAPIまたはユーザー設定として保存し、反映する | 中 | |
| OEM-X2 | 通知設定（レポート完了・問合せ急増・週次サマリー）をAPIで保存する | 中 | |
| OEM-X3 | 表示設定（日付形式・タイムゾーン）をAPIまたはユーザー設定で保存する | 中 | |
| OEM-X4 | パスワード変更・二要素認証を認証APIと連携する | 高 | 統合 NFR-2 セキュリティ |
| OEM-X5 | データエクスポートで利用統計・問合せ分析データをCSV等でダウンロードする（APIまたはバッチ） | 中 | |

---

## 5. 3アプリ間のデータ連動・API要件

### 5.1 統計・イベントの収集

| ID | 要件 | 優先度 | 備考 |
|:--|:--|:--|:--|
| API-1 | エンドユーザー・コールセンターの「検索」「チャット送信」「プロアクティブ閲覧」をバックエンドで受信し、永続化する | 最高 | 現状は localStorage のみで同一オリジン制約あり |
| API-2 | 統計は「エンドユーザー」と「サポートスタッフ」を区別して集計し、管理画面のフィルタで利用できるようにする | 高 | |
| API-3 | 集計指標: 総質問数、回答精度、トピック別件数、プロアクティブ配信数・閲覧数、アクティブユーザー数等をAPIで提供する | 高 | |

### 5.2 共通API方針

| ID | 要件 | 優先度 |
|:--|:--|:--|
| API-4 | RAG検索・チャット対話は共通APIとし、クライアント種別（エンドユーザー/コールセンター）と車種・年式をパラメータで渡す | 高 |
| API-5 | 管理画面は認証済みセッションでAPIにアクセスし、テナント（OEM）単位でデータを分離する | 高 |
| API-6 | 同一オリジンまたはCORSを正しく設定し、本番では localStorage に依存しない統計連動とする | 高 |

### 5.3 モック連動の注意（現状）

- **file:// では連動しない**: localStorage はオリジンごとに分離されるため、必ず同一オリジン（例: `npm run serve` で `http://localhost:3000/public/`）で開く必要がある。
- **本番**: 統計・イベントはバックエンドに送信し、管理画面はAPIから集計データを取得する方式に移行すること。

---

## 6. 非機能要件（モック完成に必要な範囲）

### 6.1 認証・認可

| ID | 要件 | 備考 |
|:--|:--|:--|
| NFR-A1 | エンドユーザー・コールセンター・管理画面のいずれも、認証後にのみ利用可能とする | 統合 NFR-2 に準拠 |
| NFR-A2 | 管理画面のロール（管理者・アナリスト・コンテンツ管理者・閲覧者）に応じて、コンテンツ管理・ユーザー管理の操作可否を制御する | OEM-U1〜OEM-X5 と整合 |

### 6.2 パフォーマンス・UX

| ID | 要件 |
|:--|:--|
| NFR-P1 | 検索・チャットのAPI応答は1秒以内を目標とする（統合 NFR-1 準拠） |
| NFR-P2 | 管理画面のダッシュボード・統計は、必要に応じてキャッシュや集計バッチで負荷を軽減する |

### 6.3 セキュリティ・プライバシー

| ID | 要件 |
|:--|:--|
| NFR-S1 | 通信はTLSで暗号化する |
| NFR-S2 | 個人を特定できるデータは、統計・レポートで匿名化または集計に限定する |

---

## 7. 既存「統合_システム要件定義書」との対応（漏れていた要件の整理）

以下の要件は統合版に**画面・フロー単位で明示されていなかった**ため、本ドキュメントで補足した。

| カテゴリ | 統合版での記載 | 本ドキュメントで追加した要件 |
|:--|:--|:--|
| エンドユーザー | FR-3.2 スマホアプリ、FR-1 RAG、FR-2 プロアクティブ | ログイン・車種永続化、検索/チャット/プロアクティブのAPI接続、統計連動、タブ（通知・ステータス）、設定の保存（EU-*） |
| コールセンター | FR-3.3 Web版Chatbot | 認証、モデル・年式のAPI連携、スタッフ発統計の区別、ステップガイドのAPI連携（CC-*） |
| 管理画面 | FR-3.4 Web管理画面、データ分析 | ダッシュボード・利用統計・問合せ分析のAPI取得、コンテンツ管理のCRUD、ユーザー管理のCRUD、設定の保存、レポートDL（OEM-*） |
| 連動 | データ還流（FR-4）は Phase 2 中心 | Phase 1 で必要な「3アプリ間の統計・イベント収集と管理画面での表示」をAPI-* で明示 |

---

## 8. 実装優先度サマリ

| 優先度 | 対象 | 主な要件ID |
|:--|:--|:--|
| **最高** | 全チャネル | EU-S1, EU-C1, CC-V1, CC-C1, OEM-D1〜D4, OEM-C1〜C3, API-1〜API-3, API-4〜API-6 |
| **高** | 認証・車種・統計 | EU-A1〜A2, EU-V1〜V2, EU-S2〜S4, EU-C2〜C4, EU-P1〜P2, CC-A1, CC-C2〜C3, OEM-A1〜A2, OEM-S1, OEM-I1, OEM-U1〜U4, OEM-X4 |
| **中** | プロアクティブ・設定・エクスポート | EU-P3, EU-N1, EU-SET1, OEM-D5, OEM-S2〜S3, OEM-C4〜C5, OEM-U5, OEM-X1〜X3, OEM-X5 |
| **低** | 通知・ステータス・将来拡張 | EU-N2, CC-NFR2, OEM-I3 |

---

## 9. 参照ドキュメント・モック

- **統合要件定義書**: `docs/output/統合_システム要件定義書.md`
- **エンドユーザー向けモック**: `public/index.html`
- **コールセンター向けモック**: `public/call-center.html`、`public/chat-engine-cc.js`
- **管理画面モック**: `docs/mockups/oem-dashboard.html`（本番用に `public/oem-dashboard.html` を利用する場合は同一内容を維持すること）

---

**作成者**: 開発部門  
**次回更新**: 詳細設計・API仕様確定時  
**モック完成のための要件定義書 作成日**: 2026年1月28日
